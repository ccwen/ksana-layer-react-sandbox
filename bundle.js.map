{
  "version": 3,
  "sources": [
    "../Users/cheahshen/AppData/Roaming/npm/node_modules/ksana-cli/node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "ksana-layer-react-sandbox/index.js",
    "ksana-layer-react-sandbox/src/intertextdata.js",
    "ksana-layer-react-sandbox/src/main.jsx",
    "node_modules/ksana-layer-react/index.js",
    "node_modules/ksana-layer-react/src/caretpos.js",
    "node_modules/ksana-layer-react/src/defaultspan.js",
    "node_modules/ksana-layer-react/src/flattenview.js",
    "node_modules/ksana-layer-react/src/interline.js",
    "node_modules/ksana-layer-react/src/interlineview.js",
    "node_modules/ksana-layer-react/src/intertext/index.js",
    "node_modules/ksana-layer-react/src/intertext/intertext.js",
    "node_modules/ksana-layer-react/src/keyboard_mixin.js",
    "node_modules/ksana-layer-react/src/linkview.js",
    "node_modules/ksana-layer-react/src/markup2tag.js",
    "node_modules/ksana-layer-react/src/markupselector.js",
    "node_modules/ksana-layer-react/src/markuputil.js",
    "node_modules/ksana-layer-react/src/revision/edit.js",
    "node_modules/ksana-layer-react/src/revision/editcontrol.js",
    "node_modules/ksana-layer-react/src/revision/editmode.js",
    "node_modules/ksana-layer-react/src/revision/index.js",
    "node_modules/ksana-layer-react/src/revision/note.js",
    "node_modules/ksana-layer-react/src/revision/redlinethrough.js",
    "node_modules/ksana-layer-react/src/revision/revision.js",
    "node_modules/ksana-layer-react/src/selectableview.js",
    "node_modules/ksana-layer-react/src/selection.js",
    "node_modules/ksana-layer-react/src/textrange.js",
    "node_modules/ksana-layer-react/src/typedef.js",
    "node_modules/ksana2015-webruntime/checkbrowser.js",
    "node_modules/ksana2015-webruntime/downloader.js",
    "node_modules/ksana2015-webruntime/fileinstaller.js",
    "node_modules/ksana2015-webruntime/filelist.js",
    "node_modules/ksana2015-webruntime/filelist_mui.js",
    "node_modules/ksana2015-webruntime/html5fs.js",
    "node_modules/ksana2015-webruntime/htmlfs.js",
    "node_modules/ksana2015-webruntime/index.js",
    "node_modules/ksana2015-webruntime/installkdb.js",
    "node_modules/ksana2015-webruntime/kfs.js",
    "node_modules/ksana2015-webruntime/kfs_html5.js",
    "node_modules/ksana2015-webruntime/ksanagap.js",
    "node_modules/ksana2015-webruntime/livereload.js",
    "node_modules/ksana2015-webruntime/liveupdate.js",
    "node_modules/ksana2015-webruntime/mkdirp.js"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/CA;AACA;AACA;AACA;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5GA;AACA;AACA;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "var React=require(\"react\");\r\nvar runtime=require(\"ksana2015-webruntime\");\r\nruntime.boot(\"sandbox\",function(){\r\n\tksana.runtime=runtime;\r\n\tvar Main=React.createElement(require(\"./src/main.jsx\"));\r\n\tksana.mainComponent=React.render(Main,document.getElementById(\"main\"));\r\n});",
    "var text=\"此證信序，又名通序，諸經通有故；亦名經後序，佛初說經，本無此序，至結集時始加入故；\"\r\n+\"亦名遺教序，佛將涅槃，阿難尊者欽奉遺命，一切經首當置如是我聞，一時佛在某處，與某大眾若干人俱，等語故。\"\r\n+\"命置如是云云者，證明是佛所說，以起信故。故曰證信序也。\";\r\n\r\nvar links={\r\n  a1:{s:1,l:2,type:\"intertext\", caption:\"同義\", className:\"synonym\" ,group:\"a1\"}\r\n  ,a2:{s:7,l:1,type:\"intertext\", caption:\"同義\", className:\"synonym\",group:\"a1\"}\r\n  ,a3:{s:18,l:2,type:\"intertext\", caption:\"同義\", className:\"synonym\",group:\"a1\"}\r\n  ,a4:{s:43,l:2,type:\"intertext\", caption:\"同義\", className:\"synonym\",group:\"a1\"}\r\n\r\n  ,a5:{s:10,l:5,type:\"intertext\", caption:\"因\", className:\"cause\",group:\"a5\"}\r\n  ,a6:{s:7,l:2,type:\"intertext\", caption:\"果\", className:\"effect\",group:\"a5\"}\r\n\r\n\r\n  ,a7:{s:22,l:18,type:\"intertext\", caption:\"因\", className:\"cause\",group:\"a7\"}\r\n  ,a8:{s:18,l:3,type:\"intertext\", caption:\"果\", className:\"effect\",group:\"a7\"}\r\n\r\n  //,a2:{s:3,l:3,type:\"因\"}\r\n}\r\n\r\nvar tagStyles={ \r\n\r\n  synonym:{borderBottom:\"2px solid green\"}\r\n  ,cause:{borderBottom:\"2px solid blue\"}\r\n  ,effect:{borderBottom:\"2px dotted blue\"}\r\n  //,test:{color:\"blue\"}  can overwrite setting in css\r\n}\r\nvar selections=[\r\n]\r\nmodule.exports={text:text,links:links,tagStyles:tagStyles,selections:selections};",
    "var React=require(\"react\");\r\nvar KsanaLayerReact=require(\"ksana-layer-react\");\r\nvar FlattenView=KsanaLayerReact.FlattenView;\r\nvar SelectableView=KsanaLayerReact.SelectableView;\r\nvar InterlineView=KsanaLayerReact.InterlineView;\r\n\r\nvar intertextdata=require(\"./intertextdata\");\r\nvar text=\"道可道非常道。名可名非常名。\"; //need extra space for revision at 12\r\n\r\n\r\nvar tags=[\r\n  {s:2,l:4,className:\"test\" }\r\n  ,{s:4,l:5,className:\"test2\" }\r\n];\r\nvar tags2=[\r\n  {s:2,l:4,className:\"test\",before:(React.createElement(\"button\", {key: \"1\"}, \"1\")),after:(React.createElement(\"button\", {key: \"2\"}, \"2\")) }\r\n  ,{s:4,l:5,className:\"test2\",before:(React.createElement(\"a\", {href: \"#\", key: \"1\"}, \"1\")),after:(React.createElement(\"a\", {href: \"#\", key: \"2\"}, \"2\")) }\r\n];\r\n\r\nvar tagStyles={ \r\n  test2:{backgroundColor:\"yellow\"}\r\n  //,test:{color:\"blue\"}  can overwrite setting in css\r\n}\r\n\r\nvar Selector=React.createClass({displayName: \"Selector\",\r\n  onChange:function(e) {\r\n    this.props.action(\"setselectable\",e.target.value);\r\n  }\r\n  ,render:function() {\r\n    return React.createElement(\"select\", {onChange: this.onChange}, React.createElement(\"option\", {value: \"no\"}, \"No\"), \r\n    React.createElement(\"option\", {value: \"single\"}, \"Single\"), \r\n    React.createElement(\"option\", {value: \"multiple\"}, \"Multiple\"))\r\n  }\r\n});\r\n/*\r\n\r\n\r\n      */\r\nvar markups={ //overlap\r\n  a1:{s:4,l:1,type:\"rev\",t:\"恆\",note:\"馬王堆3\",author:\"y3\"}\r\n  ,a2:{s:4,l:1,type:\"rev\",t:\"𢛢\",note:\"馬王堆2\",author:\"y2\"}\r\n  ,a3:{s:4,l:1,type:\"rev\",t:\"恒\",note:\"馬王堆\",author:\"y1\"}\r\n  ,a4:{s:11,l:1,type:\"rev\",t:\"恒\",note:\"馬王堆3\",author:\"y1\"}\r\n  ,a5:{s:13,l:0,type:\"rev\",t:\"！\",note:\"馬王堆3\",author:\"y1\"}\r\n};\r\n//markups={};\r\n\r\n\r\nvar maincomponent = React.createClass({displayName: \"maincomponent\",\r\n  action:function(act,p1) {\r\n    if (act===\"setselectable\") {\r\n      this.setState({selectable:p1});\r\n    }\r\n  }\r\n  ,getInitialState:function() {\r\n    return {selectable:\"no\",editing:null};\r\n  }\r\n  ,onSelectText:function(start,len,t) {\r\n    this.start=start;\r\n    this.seltext=t;\r\n  }\r\n  ,newMarkup:function() {\r\n    var mid='m'+Math.random().toString().substr(3,6);\r\n    markups[mid]= {s:this.start,l:this.seltext.length,type:\"rev\",t:\"\",author:\"y1\"};\r\n    this.setState({editing:mid});\r\n  }\r\n  ,onClickTag:function(mid) {\r\n    console.log(\"click\",mid);\r\n  }\r\n  ,onDoneEdit:function(mid) {\r\n    console.log(\"doneedit\",mid);\r\n    var m=markups[mid];\r\n    if (m.t===\"\" && m.l===0) {\r\n      delete markups[mid];\r\n    }\r\n    this.setState({editing:null});\r\n  }\r\n  ,onKeyPress:function(e) {\r\n    if (e.key==\" \") {\r\n      if (!this.start) return;\r\n      this.newMarkup();\r\n    }\r\n    e.preventDefault();\r\n  }\r\n  ,onHover:function(mid,previous) {\r\n    console.log(mid,previous);\r\n  }\r\n  ,render: function() {\r\n    return React.createElement(\"div\", {style: {fontSize:\"200%\"}}, \r\n\r\n    React.createElement(\"div\", null, \"MultiLinkView\"), \r\n    React.createElement(InterlineView, {selections: intertextdata.selections, \r\n      onClickTag: this.onClickTag, \r\n      onHover: this.onHover, \r\n       text: intertextdata.text, markups: intertextdata.links, styles: intertextdata.tagStyles}), \r\n      \r\n\r\n    React.createElement(\"div\", null, \"InterlineView\"), \r\n      React.createElement(InterlineView, {user: \"y1\", onSelectText: this.onSelectText, selectable: \"single\", \r\n        onDoneEdit: this.onDoneEdit, \r\n        allowKeys: [\" \"], onKeyPress: this.onKeyPress, editing: this.state.editing, \r\n        text: text, markups: markups, styles: tagStyles})\r\n     );\r\n  }\r\n});\r\nmodule.exports=maincomponent;\r\n/*\r\n    <div>FlattenView<br/>\r\n      <FlattenView text={text} tags={tags} styles={tagStyles} />\r\n    </div>\r\n\r\n   <div>SelectableView<Selector action={this.action}/></div>\r\n      <SelectableView text={text} selectable=\"multiple\" styles={tagStyles} />\r\n      <SelectableView text={text} selectable={this.state.selectable} tags={tags2} styles={tagStyles} />\r\n\r\n\r\n\r\n*/\r\n\r\n",
    "var FlattenView=require(\"./src/flattenview\");\r\nvar SelectableView=require(\"./src/selectableview\");\r\nvar InterlineView=require(\"./src/interlineview\");\r\nvar LinkView=require(\"./src/linkview\");\r\n//var MultiLinkView=require(\"./src/multilinkview\");\r\nvar textrange=require(\"./src/textrange\");\r\nvar markuputil=require(\"./src/markuputil\");\r\n\r\n//var BaseView=require(\"./src/baseview\");\r\n//var MultiSelectView=require(\"./src/multiselectview\");\r\n//var ReviseView=require(\"./src/reviseview\");\r\n\r\n\r\n//var RevisionView=require(\"./src/revisionview\");\r\n\r\nmodule.exports={FlattenView:FlattenView\r\n\t,SelectableView:SelectableView\r\n\t,InterlineView:InterlineView\r\n\t,LinkView:LinkView\r\n//\t,MultiLinkView:MultiLinkView\r\n\t,textrange:textrange\r\n  ,markuputil:markuputil\r\n};",
    "var create=function(_text) {\r\n\tvar caretPos={},pos=0,text=_text;\r\n\r\n\tcaretPos.get=function(){\r\n\t\treturn pos;\r\n\t}\r\n\r\n\tvar nonstop=function(code) {\r\n\t\treturn (code>=0xDC00 && code<=0xDFFF) || (code>=0x0f71 && code<=0x0f87)|| (code>=0x0f8d && code<=0x0fbc);\r\n\t}\r\n\r\n\tvar snapNext=function(_pos) {\r\n\t\tif (typeof _pos==\"undefined\") _pos=pos;\r\n\t\tvar code=text.charCodeAt(_pos);\r\n\t\twhile (nonstop(code)) {\r\n\t\t\t_pos++;\r\n\t\t\tcode=text.charCodeAt(_pos);\r\n\t\t}\r\n\t\treturn _pos\t}\r\n\tvar snapPrev=function(_pos) {\r\n\t\tif (typeof _pos==\"undefined\") _pos=pos;\r\n\t\tvar code=text.charCodeAt(_pos);\r\n\t\twhile (nonstop(code)) {\r\n\t\t\t_pos--;\r\n\t\t\tcode=text.charCodeAt(_pos);\r\n\t\t}\r\n\t\treturn _pos;\t\r\n\t}\t\r\n\tcaretPos.next=function(_pos){\r\n\t\tpos=snapPrev(_pos);\r\n\t\tpos++;\t\r\n\t\tvar code=text.charCodeAt(pos);\r\n\t\twhile (nonstop(code)) {\r\n\t\t\tpos++;\r\n\t\t\tcode=text.charCodeAt(pos);\r\n\t\t}\r\n\t\tif (pos>text.length) pos=text.length;\r\n\t\treturn pos;\r\n\t}\r\n\tcaretPos.nextToken=function(_pos) {\r\n\t\tvar start=snapPrev(_pos);\r\n\t\tthis.next(start);\r\n\t\treturn text.substring(start,pos);\r\n\t}\r\n\tcaretPos.prevToken=function(_pos) {\r\n\t\tvar end=snapNext(_pos);\r\n\t\tthis.prev(end);\r\n\t\treturn text.substring(pos,end);\r\n\t}\r\n\tcaretPos.prev=function(_pos) {\r\n\t\tpos=snapNext(_pos);\r\n\t\tpos--;\r\n\t\tvar code=text.charCodeAt(pos);\r\n\t\twhile (nonstop(code)) {\r\n\t\t\tpos--;\r\n\t\t\tcode=text.charCodeAt(pos);\r\n\t\t}\r\n\t\tif (pos<0) pos=0;\r\n\t\treturn pos;\r\n\t}\r\n\tcaretPos.valid=function(_pos) {\r\n\t\treturn !nonstop(text.charCodeAt(_pos));\r\n\t}\r\n\r\n\treturn caretPos;\r\n}\r\nmodule.exports={create:create};",
    "/*\n  Span's styles is created by merging styles of all tags covering the span.\n*/\ntry {\n  var React=require(\"react-native\");\n  var PureRenderMixin=null;\n} catch(e) {\n  var React=require(\"react/addons\");\n  var PureRenderMixin = React.addons.PureRenderMixin;\n}\nvar E=React.createElement,PT=React.PropTypes;\n\n\nvar mergeStyles=function(styles) {\n  if (!styles.length) return {}; //should return {} instead of null , otherwise react don't apply style\n  var out={};\n  for (var i=0;i<styles.length;i++) {\n    for (var key in styles[i]) {\n      out[key]=styles[i][key];\n    }\n  }\n  return out;\n}\nvar SpanClass = React.createClass({\n  displayName:\"defaultSpan\"\n  ,mixins:[PureRenderMixin]\n  ,propTypes:{\n    tid:PT.array\n    ,index:PT.number\n    ,tags:PT.array.isRequired\n    ,start:PT.number.isRequired\n    ,tagStyles:PT.object\n    ,onLeaveTag:PT.func\n    ,onEnterTag:PT.func\n  }\n  ,getTagStyle:function(tid) {\n    if (!tid) return {};\n    var out=[];\n    for (var i=0;i<tid.length;i++){\n      var m=tid[i];\n      var styles=this.props.styles;\n      var tag=this.props.tags[m];\n      tag.style&&out.push(tag.style);\n      var type=tag.className;\n      styles[type]&&out.push(styles[type]);\n      styles[type+\"_first\"]&&out.push(styles[type+\"_first\"]);\n      styles[type+\"_last\"]&&out.push(styles[type+\"_last\"]);        \n    };\n    return out;\n  }\n  ,getTagType:function(tid){\n    if (!tid) return [];\n    var out=[];\n    for (var i=0;i<tid.length;i++){\n      var m=tid[i];\n      var styles=this.props.styles;\n      var tag=this.props.tags[m];\n      var type=tag.className;\n      type&&out.push(type);\n    }\n    return out;\n  }\n  ,getTid:function(e) {\n    var node=e.target;\n    while (node&&typeof node.dataset[\"start\"]==\"undefined\") {\n      node=node.parentNode;\n    }\n    var tid=node.dataset[\"tid\"];\n    return tid;\n  }\n  ,onMouseEnter:function(e) {\n    var tid=this.getTid(e);\n    if(this.props.onEnterTag && tid) this.props.onEnterTag(e,tid);\n  }\n  ,onMouseLeave:function(e) {\n    var tid=this.getTid(e);\n    if(this.props.onLeaveTag && tid) this.props.onLeaveTag(e,tid);\n  }\n  ,render:function() {\n    var styles=this.getTagStyle(this.props.tid);\n    var style=mergeStyles(styles);\n    var span=React.Text||\"span\";\n    \n    var props={\"data-tid\":this.props.tid,style:style,\"data-start\":this.props.start\n    ,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave};    \n    props.className=this.getTagType(this.props.tid).join(\" \");  //pass className as it's  \n    \n    return E(span,props,this.props.children);\n  }\n});\nmodule.exports=SpanClass;\n",
    "/*\r\n\tCore markup display component,\r\n\t\"flatten\" text, tags (with styles) to single layer.\r\n*/\r\ntry {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\n\r\n\r\nvar spreadMarkup=require(\"./markuputil\").spreadMarkup;\r\nvar caretPos=require(\"./caretpos\");\r\nvar defaultSpan=require(\"./defaultspan\");\r\nvar FlattenView=React.createClass({\r\n\tdisplayName:\"FlattenView\"\r\n\t,mixins:[PureRenderMixin]\r\n\t,propTypes:{\r\n\t\ttext:React.PropTypes.string.isRequired\r\n\t\t,tags:PT.array\r\n\t\t,styles:PT.object\r\n\t\t,span:PT.func\r\n\t\t,style:PT.object\r\n\t\t,allowKeys:PT.array\r\n\t\t,onEnterTag:PT.func\r\n\t\t,onLeaveTag:PT.func\r\n\t}\r\n\t,getDefaultProps:function() {\r\n\t\treturn {tags:[],styles:{},span:defaultSpan};\r\n\t}\r\n\t,tagAtPos:[] // hold covering tags given a text position\r\n\t,mergeStyle:function(style) {\r\n\t\tthis.style=style||{};\r\n\t\tif (!this.style.lineHeight||!this.style.outline) {\r\n\t\t\tthis.style=update(this.style,{$merge:{\r\n\t\t\t\toutline : \"0px solid transparent\", lineHeight:\"180%\"\r\n\t\t\t}});\r\n\t\t}\t\t\r\n\t}\r\n\t,componentWillMount:function() {\r\n\t\tthis.mergeStyle(this.props.style);\r\n\t\tthis.tagAtPos=spreadMarkup(this.props.tags);\r\n\t}\r\n\t,componentWillReceiveProps:function(nextProps) {\r\n\t\tthis.mergeStyle(nextProps.style);\r\n\t\tthis.tagAtPos=spreadMarkup(nextProps.tags);\r\n\t}\r\n\t,renderSpan:function(out,start,end,spantext,tid) {\r\n\t\tvar before=[],after=[], tags=this.props.tags;\r\n\t\t(tid||[]).map(function(m){ \r\n\t\t\tif (tags[m].before&& start===tags[m].s) { \r\n\t\t\t\tbefore.push(tags[m].before);\r\n\t\t\t}\r\n\t\t});\r\n\t\tbefore.length && out.push(E(React.Text||\"span\",{key:\"b\"+start},before));\r\n\r\n\t\tout.push(E(this.props.span,{index:this.props.index\r\n\t\t\t\t\t,onEnterTag:this.props.onEnterTag,onLeaveTag:this.props.onLeaveTag\r\n\t\t\t\t\t,styles:this.props.styles,key:'s'+start, tags:tags,tid:tid,start:start}\r\n\t\t\t\t,spantext)\r\n\t\t);\r\n\r\n\t\t(tid||[]).map(function(m){ \r\n\t\t\tif (tags[m].after && end===tags[m].s+tags[m].l) {\r\n\t\t\t\tafter.push(tags[m].after);\r\n\t\t\t} \r\n\t\t});\r\n\t\t\r\n\t\tafter.length && out.push(E(React.Text||\"span\",{key:\"a\"+start},after));\r\n\t\treturn out;\r\n\t}\r\n\t,renderChildren:function() {\r\n\t\tvar sameArray=function(a1,a2) {\r\n\t\t\tif (!a1 && !a2) return true; //both are empty\r\n\t\t\tif ((!a1 && a2) || (a1 && !a2) ) return false;\r\n\t\t\treturn a1.toString()===a2.toString(); //one dimensional array\r\n\t\t}\r\n\t\tvar out=[], spantext=\"\" ,start=0, previous=[\"impossible item\"] ;\r\n\t\tvar caretpos=caretPos.create(this.props.text);\r\n\r\n\t\twhile (caretpos.get()<this.props.text.length) {\r\n\t\t\tvar i=caretpos.get();\r\n\t\t\tif (!sameArray(this.tagAtPos[i],previous)) {\r\n\t\t\t\tspantext && (out=this.renderSpan(out,start,i,spantext,previous));\r\n\t\t\t\tstart=i;\r\n\t\t\t\tspantext=\"\";\r\n\t\t\t}\r\n\t\t\tprevious=(this.tagAtPos[i]&&this.tagAtPos[i].length)?JSON.parse(JSON.stringify(this.tagAtPos[i])):null; \r\n\t\t\tif (i>this.tagAtPos.length) break;\r\n\t\t\tspantext += caretpos.nextToken();\r\n\t\t}\r\n\t\tspantext=this.props.text.substr(start);\r\n\t\tspantext && (out=this.renderSpan(out,start,i,spantext,previous));\r\n\t\treturn out;\r\n\t}\r\n\t,render:function() {\r\n\t\tvar props=update(this.props, {$merge:{spellCheck:false, style:this.style}});\r\n\t\treturn E(React.View||\"div\",props,this.renderChildren());\r\n\t}\r\n});\r\nmodule.exports=FlattenView;",
    "try {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\n\r\nvar Embed=React.createClass({\r\n\trender:function() {\r\n\t\treturn E(\"span\",this.props,this.props.children);\r\n\t}\r\n});\r\nvar Super=React.createClass({\r\n\trender:function() {\r\n\t\treturn E(\"div\",{className:\"interline\",style:{position:\"absolute\",left:0,top:\"-1.2em\",width:\"1000px\"}}\r\n\t\t\t,this.props.children);\r\n\t}\r\n});\r\nvar Sub=React.createClass({\r\n\trender:function() {\r\n\t\treturn E(\"div\",{className:\"interline\",style:{position:\"absolute\",left:0,top:\"0.6em\",width:\"1000px\"}}\r\n\t\t\t,this.props.children);\r\n\t}\r\n});\r\nvar Container=React.createClass({\r\n\trender:function() {\r\n\t\treturn E(\"span\",{style:{position:\"relative\"}}\r\n\t\t\t,this.props.children);\r\n\t}\r\n});\r\n\r\nmodule.exports={Container:Container,Super:Super, Sub:Sub, Embed:Embed};",
    "/*\r\n\tInterlineView\r\n\tfilter markups and create tags and pass to selectableview\r\n\r\n\tmarkups : data from firebase,\r\n\t          interline editor mutate markups and write back to database.\r\n\r\n\ttags: with before/after component and className, ready for render\r\n\t\t    tags are generated on-the-fly , no need to save.\r\n\r\n*/\r\n\r\ntry {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\n\r\nvar SelectableView=require(\"./selectableview\");\r\nvar markup2tag=require(\"./markup2tag\");\r\nvar keyboard_mixin=require(\"./keyboard_mixin\");\r\nvar typedef=require(\"./typedef\");\r\n\r\nvar InterlineView=React.createClass({\r\n\tmixins:[PureRenderMixin]\r\n\t,propTypes:{\r\n\t\tmarkups:PT.object.isRequired  //markup from firebase\r\n\t\t,user:PT.string\r\n\t\t,allowkeys:PT.array\r\n\t\t,onKeyPress:PT.func\r\n\t\t,selections:PT.array\r\n\t\t,onEditTag:PT.func\r\n\t\t,onDoneEdit:PT.func\r\n\t\t,onKeyPress:PT.func\r\n\t\t,onFocus:PT.func\r\n\t\t,onBlur:PT.func\r\n\t\t,onHover:PT.func\r\n\t}\r\n\t,getInitialState:function() {\r\n\t\tvar allowKeys=keyboard_mixin.arrowkeys;\r\n\t\tif (this.props.allowKeys && this.props.allowKeys.length) {\r\n\t\t\tallowKeys=allowKeys.concat(this.props.allowKeys);\r\n\t\t}\r\n\t\t//markupActivated : { mid: true , mid: false }; //otherwise it is not initialized\r\n\t\treturn {tags:[],editing:null,hovering:null,markupActivated:{},allowKeys:allowKeys};\r\n\t}\r\n\t,onKeyPress:function(e) {\r\n\t\tvar nn=e.target.nodeName;\r\n\t\tif (nn===\"INPUT\" || nn===\"TEXTAREA\") return;\r\n\r\n\t\tif (this.state.allowKeys.indexOf(e.key)>-1) {\r\n\t\t\tif (this.props.onKeyPress) this.props.onKeyPress(e);\r\n\t\t} else {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t}\r\n\t,componentWillUpdate:function(nextProps,nextState) {\r\n\t\tthis.markup2tag(nextProps,nextState);\r\n\t}\r\n\t,componentDidMount:function() {\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\t,markup2tag:function(nextProps,nextState) {\r\n\t\tvar context={editing:nextState.editing\r\n\t\t\t,hovering:nextState.hovering\r\n\t\t\t,hoveringMarkup:this.props.markups[nextState.hovering]\r\n\t\t\t,text:nextProps.text\r\n\t\t\t,action:this.action,markupActivated:nextState.markupActivated,action:this.action\r\n\t\t\t,styles:this.props.styles};\r\n\r\n\t\tnextState.tags=markup2tag(nextProps.markups,context);\r\n\t\tnextState.markupActivated=context.markupActivated; //markup2tag might change markupActivated\r\n\t}\r\n  ,activateMarkup:function(mid) {\r\n  \tvar m=this.props.markups[mid];\r\n  \tif (!m)return;\r\n\t\tvar markupActivated=this.deactivateOverlapMarkup(m.s,m.l);\r\n\t\tvar activate={};\r\n\t\tactivate[mid]=true;\r\n\t\tvar ma=update(markupActivated,{$merge:activate});\r\n\t\tthis.setState({editing:null,hovering:null,markupActivated:ma});\r\n  }\r\n  ,componentWillReceiveProps:function(nextProps) {\r\n  \tif (nextProps.editing!==this.props.editing) {\r\n  \t\tthis.activateOrEditMarkup(nextProps.editing,nextProps);\r\n  \t}\r\n  }\r\n  ,activateOrEditMarkup:function(mid,props) {\r\n  \tif (!props) props=this.props;\r\n  \tif (!mid || !this.props.markups[mid]) return;\r\n  \tif (this.props.markups[mid].author===this.props.user) {\r\n  \t\tthis.setState({editing:mid,hovering:null});\r\n  \t} else {\r\n  \t\tthis.activateMarkup(mid);\r\n  \t}\r\n  }\r\n  ,clickTag:function(mid){\r\n  \t//translate click event to \r\n  \tvar m=this.props.markups[mid];\r\n  \tvar T=typedef[m.type];\r\n\r\n  \tif(T&&T.translateClick) {\r\n  \t\tvar activated=this.state.markupActivated[mid];\r\n  \t\tvar act=T.translateClick(m,activated);\r\n  \t\tthis.action(act,mid);\r\n  \t} else {\r\n\t  \tthis.props.onClickTag&&this.props.onClickTag(mid);\r\n\t  \tthis.setState({editing:null,hovering:null});\r\n  \t}\r\n  }\r\n  ,deactivateMarkup:function(mid) {\r\n\t\tvar markupActivated=this.state.markupActivated;\r\n\t\tvar deactive={};\r\n\t\tdeactive[mid]=false;\r\n\t\tvar ma=update(markupActivated,{$merge:deactive});\r\n\t\tthis.setState({editing:null,hovering:null,markupActivated:ma});\r\n  }\r\n  ,deactivateOverlapMarkup:function(start,len) {\r\n\t\t//set state to 0 for any overlap markup\r\n\t\tvar deactive={};\r\n\t\tfor (var mid in this.props.markups) {\r\n\t\t\tvar m=this.props.markups[mid];\r\n\t\t\tif (!(start>=m.s+m.l || start+len<=m.s) ) {\r\n\t\t\t\tif (this.state.markupActivated[mid]) deactive[mid]=false;\r\n\t\t  }\r\n\t\t\tif (start===m.s && this.state.markupActivated[mid]) deactive[mid]=false;\r\n\t\t};\r\n\t\treturn update(this.state.markupActivated,{$merge:deactive});\r\n  }\r\n  ,setMarkup:function(mid,key,value) {\r\n  \tvar m=this.props.markups[mid];\r\n  \tvar obj={};\r\n  \tobj[key]=value;\r\n  \tthis.props.markups[mid]=update(m,{$merge:obj});\r\n  \tthis.forceUpdate();\r\n  }\r\n\t,action:function(act,p1,p2,p3) {\r\n\t\tif(act===\"enter\") {\r\n\t\t\tthis.props.onHover&&this.props.onHover(p1,this.state.hovering);\r\n \t\t\tthis.setState({hovering:p1}); \t\t\t\r\n\t\t} else if (act===\"leave\") {\r\n\t\t\tif (this.state.editing) {\r\n\t\t\t\tthis.props.onDoneEdit&&this.props.onDoneEdit(this.state.editing);\r\n\t\t\t}\r\n\t\t\tthis.props.onHover&&this.props.onHover(null,this.state.hovering);\r\n\t\t\tthis.setState({hovering:null,editing:null});\r\n\t\t} else if (act===\"activate\") {\r\n\t\t\tthis.activateMarkup(p1);\r\n\t\t} else if (act===\"deactivate\") {\r\n\t\t\tthis.deactivateMarkup(p1)\r\n\t\t} else if (act===\"activate_edit\") {\r\n\t\t\tthis.activateOrEditMarkup(p1);\r\n\t\t} else if (act===\"setMarkup\") {\r\n\t\t\tthis.setMarkup(p1,p2,p3);\r\n\t\t} else if (act===\"click\") {\r\n\t\t\tthis.clickTag(p1);\r\n\t\t}\r\n\t}\r\n\t,render:function(){\r\n\t\tvar props=update(this.props,{$merge:{tags:this.state.tags,\r\n\t\t\tselectable:this.props.selectable,\r\n\t\t\tallowKeys:this.state.allowKeys,\r\n\t\t\tonFocus:this.props.onFocus,\r\n\t\t\tonBlur:this.props.onBlur,\r\n\t\t\tselections:this.props.selections,\r\n\t\t\tonKeyPress:this.onKeyPress}});\r\n\t\tdelete props.markups;//hide markups from flattenview\r\n\t\treturn E(SelectableView,props);\r\n\t}\r\n\r\n});\r\n\r\nmodule.exports=InterlineView;",
    "\r\nvar underlinestyle={borderBottom:\"solid 0.1em green\",display:\"inline\"};\r\n//var linethroughstyle={textDecoration:\"line-through\"};\r\nvar getOldTextStyle=function(markup,mid,context) {\r\n\tvar style={};\r\n\tvar g=context.hoveringMarkup;\r\n\tif (g) g=g.group;\r\n\tif (context.hovering===mid || (g && g===markup.group)) {\r\n\t\tstyle=context.styles[markup.className];\r\n\t}\r\n\r\n\r\n// else if (context.editing===mid) style=linethroughstyle;\r\n//\telse if (context.markupActivated[mid]) style={display:\"none\"};\r\n\r\n\tif (markup.l==0) style={};\r\n\treturn style;\r\n}\r\nvar getHandleCaption=function(markup) {\r\n\treturn markup.caption;\r\n}\r\n\r\nmodule.exports={Component:require(\"./intertext\"), getStyle:getOldTextStyle ,getHandleCaption:getHandleCaption} ;",
    "try {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\n\r\nvar IL=require(\"../interline\");\r\n\r\nvar RevisionNote=require(\"../revision/note\");\r\nvar handleStyle={\r\n\t\t\tborderStyle:\"solid\",borderColor:\"gray\",fontSize:\"50%\",color:\"silver\",borderWidth:2\r\n\t\t\t,borderRadius:\"20%\",cursor:\"pointer\",verticalAlign:\"top\",\r\n\t\t\tbackgroundColor:\"drakgray\",height:\"0.5em\",width:\"0.5em\"};\r\n\r\nvar HandleButton=React.createClass({\r\n\tmixins:[PureRenderMixin]\r\n\t,propTypes:{\r\n\t\taction:PT.func.isRequired\r\n\t\t,mid:PT.string.isRequired\r\n\t\t,activated:PT.bool.isRequired\r\n\t\t,editable:PT.bool.isRequired\r\n\t}\r\n\t,activatedStyle: update(handleStyle,{$merge:{borderColor:\"green\"}})\r\n\t,getInitialState:function() {\r\n\t\treturn {style:{}};\r\n\t}\r\n\t,onMouseLeave:function(e) {\r\n\t\tthis.props.action(\"leave\",this.props.mid);\r\n\t}\r\n\t,onClick:function(e) {\r\n\t\tthis.props.action(\"click\",this.props.mid);\r\n\t}\r\n\t,onMouseEnter:function(e) {\r\n\t\tthis.props.action(\"enter\",this.props.mid);\r\n\t}\r\n\t,render:function(){\r\n\t\treturn E(\"span\",{style:this.props.activated?this.activatedStyle:handleStyle,\r\n\t\t\tonMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick},\r\n\t\t\tthis.props.children);\r\n\t}\r\n});\r\n\r\n\r\nvar InterText=React.createClass({\r\n\tdisplayName:\"InterText\"\r\n\t,mixins:[PureRenderMixin]\r\n\t,style:{display:\"none\"}\r\n\t,propTypes:{\r\n\t\tmarkup:PT.object.isRequired\r\n\t\t,mid:PT.string.isRequired\r\n\t\t,context:PT.object.isRequired\r\n\t\t,activated:PT.bool\r\n\t\t,showSuper:PT.bool\r\n\t\t,styles:PT.object\r\n\t\t,isHovering:PT.bool\r\n\t}\r\n\t,renderHandle:function() {\r\n\t\tif (this.props.showSuper) {\r\n\t\t\treturn E(HandleButton,\r\n\t\t\t\t{action:this.props.context.action,mid:this.props.mid\r\n\t\t\t\t,activated:!!this.props.activated,editable:this.props.editable||false},\r\n\t\t\t\tthis.props.markup.caption)\r\n\t\t};\r\n\t}\r\n\r\n\t,getTextStyle:function() {\r\n\t\tvar style={};\r\n\t\tif (this.props.isHovering) {\r\n\t\t\tstyle=this.props.styles[this.props.markup.className];\r\n\t\t}\r\n\t\treturn style;\r\n\t}\r\n\t,render:function() {\r\n\t\t return E(IL.Container,null\r\n\t\t\t,E(IL.Super, {}, this.renderHandle() )\r\n\t\t\t,E(IL.Embed, {}, this.props.markup.t)\r\n\t\t\t);\r\n\t}\r\n});\r\n\r\nmodule.exports=InterText;",
    "\r\nvar keyboard_mixin={\r\n\tarrowkeys:[\"ArrowRight\",\"ArrowLeft\",\"ArrowUp\",\"ArrowDown\",\"PageUp\",\"PageDown\",\"Home\",\"End\"],\r\n\tonkeydown:function(e) {\r\n\t\tvar nodename=e.target.nodeName;\r\n\t\tif (nodename===\"INPUT\" || nodename===\"TEXTAREA\") return;\r\n\t\tvar allowkeys=this.state.allowkeys||[];\r\n\t\tif (allowkeys.indexOf(e.key)>-1 || (e.ctrlKey && e.keyCode===67)) return; //allow ctrl+c\r\n\r\n\t\te.preventDefault();\r\n\t}\r\n}\r\nmodule.exports=keyboard_mixin;",
    "/*\r\n\tView for building intertextual link.\r\n*/\r\ntry {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\n\r\nvar SelectableView=require(\"./selectableview\");\r\nvar keyboard_mixin=require(\"./keyboard_mixin\");\r\nvar styles={\r\n\tlink:{borderBottom:\"2px solid #0000ff\"}\r\n\t,highlight:{background:\"yellow\",borderRadius:\".5em\",borderBottom:\"\"}\r\n}\r\n\r\nvar InterlineView=React.createClass({\r\n\tmixins:[PureRenderMixin]\r\n\t,propTypes:{\r\n\t\tlinks:PT.object\r\n\t\t,highlights:PT.array\r\n\t\t,selections:PT.array\r\n\t\t,user:PT.string\r\n\t\t,allowkeys:PT.array\r\n\t\t,onKeyPress:PT.func\r\n\t\t,onHoverLink:PT.func\r\n\t}\r\n\t,getDefaultProps:function() {\r\n\t\treturn {links:{},highlights:[],selections:[],user:\"anonymous\"};\r\n\t}\r\n\t,componentWillUpdate:function(nextProps,nextState) {\r\n\t\tthis.combinetag(nextProps,nextState);\r\n\t}\r\n\t,componentDidMount:function() {\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\t,combinetag:function(props,state) {\r\n\t\tvar tags=[];\r\n\t\tfor (var key in props.links) {\r\n\t\t\tprops.links[key].forEach(function(H){\r\n\t\t\t\ttags.push({s:H[0], l:H[1],style:styles.link, mid:key});\r\n\t\t\t});\r\n\t\t}\r\n\t\tfor (var i=0;i<props.highlights.length;i++) {\r\n\t\t\tvar H=props.highlights[i];\r\n\t\t\ttags.push({s:H[0], l:H[1], style:styles.highlight, mid:\"hover_\"+i});\t\r\n\t\t}\r\n\t\tstate.tags=tags;\r\n\t}\t\r\n\t,getInitialState:function() {\r\n\t\tvar allowKeys=keyboard_mixin.arrowkeys;\r\n\t\tif (this.props.allowKeys && this.props.allowKeys.length) {\r\n\t\t\tallowKeys=allowKeys.concat(this.props.allowKeys);\r\n\t\t}\r\n\t\treturn {tags:[],editing:null,hovering:null,markupActivated:{},allowKeys:allowKeys};\r\n\t}\r\n\t,onClick:function(e,reactid) {\r\n\t\tif (this.hoveringTag && this.props.onClickTag) {\r\n\t\t\tthis.props.onClickTag(e,reactid,this.hoveringTag);\r\n\t\t}\r\n\t}\r\n\t,onLeaveTag:function(e,tid) {\r\n\t\tthis.hovering=null;\r\n\t\tthis.hoveringTag=null;\r\n\t\tvar leavingTag=null;\r\n\t\tif (this.state.tags[tid]) leavingTag=this.state.tags[tid].mid;\r\n\t\te.target.style.cursor=\"\";\r\n\t\tif (this.props.onLeaveTag) {\r\n\t\t\tthis.props.onLeaveTag(e,tid,leavingTag);\r\n\t\t}\r\n\t}\r\n\t,onEnterTag:function(e,tid) {\r\n\t\tthis.hovering=e.target;\r\n\t\tthis.hoveringTag=null;\t\r\n\t\tif (this.state.tags[tid]) this.hoveringTag=this.state.tags[tid].mid;\r\n\t\tif (this.props.onEnterTag) {\r\n\t\t\tthis.props.onEnterTag(e,tid,this.hoveringTag);\r\n\t\t}\r\n\t\te.target.style.cursor=\"pointer\";\r\n\t}\r\n\t,render:function(){\r\n\t\tvar props=update(this.props,{$merge:{tags:this.state.tags,\r\n\t\t\tselectable:this.props.selectable,\r\n\t\t\tallowKeys:this.state.allowKeys,\r\n\t\t\tonEnterTag:this.onEnterTag,\r\n\t\t\tonLeaveTag:this.onLeaveTag,\r\n\t\t\tonFocus:this.props.onFocus,\r\n\t\t\tonBlur:this.props.onBlur,\r\n\t\t\tonClick:this.onClick,\r\n\t\t\tselections:this.props.selections,\r\n\t\t\tonKeyPress:this.onKeyPress}});\r\n\t\tdelete props.markups;//hide markups from flattenview\r\n\t\treturn E(SelectableView,props);\r\n\t}\r\n\r\n});\r\n\r\nmodule.exports=InterlineView;",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar typedef=require(\"./typedef\");\r\nvar markuputil=require(\"./markuputil\");\r\nvar MarkupSelector=require(\"./markupselector\");\r\n\r\n/**\r\n\tput no conflict markup in object markupActivated\r\n*/\r\nvar defaultActiveMarkups=function(gbo,markupActivated) {\r\n\tfor (var start in gbo){\r\n\t\tfor (var mid in gbo[start]){\r\n\t\t\tif (typeof markupActivated[mid]===\"undefined\") {\r\n\t\t\t\tvar m=gbo[start][mid], T=typedef[m.type];\r\n\t\t\t\tif (T.defaultActivate) {\r\n\t\t\t\t\tmarkupActivated[mid]=T.defaultActivate(m,gbo[start]);\r\n\t\t\t\t}\r\n\t\t\t\t//markupActivated[mid]= markupcount===1? true:false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar allDisabled=function(markups,markupActivated) {\r\n\tfor (var mid in markups) {\r\n\t\tif (markupActivated[mid]) return false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nvar createMarkupSelector=function(start,context,markups) {\r\n\tvar getHandleCaption=function(markup) {\r\n\t\tvar T=typedef[markup.type];\r\n\t\treturn T.getHandleCaption?T.getHandleCaption(markup):\"\";\r\n\t}\r\n\tvar selector=E(MarkupSelector,\r\n\t\t{markups:markups,context:context,key:\"selector\",getHandleCaption:getHandleCaption} );\r\n\treturn {s:start,l:0,before:selector};\r\n}\r\n\r\n\r\nvar markup2tag=function(markups,context) {\r\n\tvar gbo=markuputil.groupByOffset(markups);\r\n\tdefaultActiveMarkups(gbo,context.markupActivated);\r\n\tvar out=[];\r\n\tvar createTag=function(mid,showSuper) {\r\n\t\t\tvar m=markups[mid], cls=cls||m.type;\r\n\t\t\tvar Component=typedef[m.type].Component;\r\n\t\t\tvar getStyle=typedef[m.type].getStyle||function(){return {}};\r\n\t\t\t//console.log(\"style\",context.hovering,getStyle(mid,context),mid)\r\n\t\t\tvar before=E(Component,\r\n\t\t\t\t\t\t\t{ mid:mid,showSuper:showSuper,\r\n\t\t\t\t\t\t\t\tisHovering:context.hovering===mid,\r\n\t\t\t\t\t\t\t\tisEditing:context.editing===mid,\r\n\t\t\t\t\t\t\t\tmarkup:m,context:context,key:mid,\r\n\t\t\t\t\t\t\t\tactivated:context.markupActivated[mid],\r\n\t\t\t\t\t\t\t\tstyles:context.styles\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\treturn {s:start, l:m.l, mid:mid, before: before, style:getStyle(m,mid,context)};\r\n\t}\r\n\tfor (var i in gbo) {\r\n\t\tvar start=parseInt(i), markups=gbo[i];\r\n\t\tvar hovering=markups[context.hovering]?context.hovering:null; //this group has hovering markup\r\n\t\tvar editing=markups[context.editing]?context.editing:null;    //this group has editing markup\r\n\t\tvar markupcount=Object.keys(markups).length;\r\n\t\tvar showSuper=true;\r\n\t\tif (!context.editing && markupcount>1 && allDisabled(markups,context.markupActivated )) {\r\n\t\t\tshowSuper=false;\r\n\t\t\tout.push(createMarkupSelector(start,context,markups));\r\n\t\t}\r\n\t\tif (editing||hovering) {\r\n\t\t\tout.push(createTag(editing||hovering,showSuper));\r\n\t\t} else {\r\n\t\t\tfor (var mid in markups) {\r\n\t\t\t\tout.push(createTag(mid, showSuper && (context.markupActivated[mid]||markupcount===1)));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn out;\r\n}\r\n\r\n\r\nmodule.exports=markup2tag;",
    "try {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\nvar IL=require(\"./interline\");\r\nvar handlerStyle={borderStyle:\"solid\",borderColor:\"gray\",fontSize:\"50%\",color:\"silver\",borderWidth:2\r\n\t\t\t,borderRadius:\"20%\",cursor:\"pointer\",verticalAlign:\"top\",\r\n\t\t\tbackgroundColor:\"drakgray\",height:\"0.5em\",width:\"0.5em\"};\r\nvar handlerStyle_hover=update(handlerStyle,{$merge:{borderColor:\"brown\"}});\r\n\r\nvar MarkupSelector=React.createClass({\r\n\tmixins:[PureRenderMixin]\r\n\t,propTypes:{\r\n\t\tmarkups:PT.object.isRequired\r\n\t\t,context:PT.object.isRequired\r\n\t\t,getHandleCaption:PT.func.isRequired\r\n\t}\r\n\t,onClick:function(e) {\r\n\t\tvar mid=e.target.dataset.mid;\r\n\t\tthis.props.context.action(\"click\",mid);\r\n\t}\r\n\t,renderHandlers:function() {\r\n\t\tvar out=[];\r\n\t\tfor (var mid in this.props.markups) {\r\n\t\t\tvar m=this.props.markups[mid];\r\n\t\t\tvar hovering=this.props.context.hovering===mid;\r\n\t\t\tvar style=hovering?handlerStyle_hover:handlerStyle;\r\n\t\t\tout.push(E(\"span\",{\"data-mid\":mid,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,\r\n\t\t\tonClick:this.onClick, key:mid,style:style},this.props.getHandleCaption(m)));\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\t,onMouseEnter:function(e) {\r\n\t\tclearTimeout(this.leavetimer);\r\n\t\tvar mid=e.target.dataset.mid;\r\n\t\tthis.props.context.action(\"enter\",mid);\r\n\t}\r\n\t,onMouseLeave:function() {\r\n\t\tvar action=this.props.context.action;\r\n\t\taction(\"leave\");//have to leave immediately as parent might be destroyed\r\n\t}\r\n\t,renderHandler:function() {\r\n\t\tif (this.props.markups[this.props.context.hovering]) {\r\n\t\t\treturn E(\"span\",{},this.renderHandlers());\r\n\t\t} else {\r\n\t\t\tvar mid=Object.keys(this.props.markups)[0];\r\n\t\t\tvar markupcount=Object.keys(this.props.markups).length;\r\n\t\t\treturn E(\"span\",{\"data-mid\":mid,\r\n\t\t\t\tstyle:handlerStyle,onMouseEnter:this.onMouseEnter\r\n\t\t\t\t,onMouseLeave:this.onMouseLeave},\"+\"+markupcount);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t,render:function() {\r\n\t\treturn E(IL.Container,{},\r\n\t\t\t\t E(IL.Super, {},this.renderHandler() )\r\n\t\t\t);\r\n\t}\r\n});\r\nmodule.exports=MarkupSelector;",
    "/**\r\n\tinput : { markupid:{markup}, markupid:{markup} }\r\n\treturn { offset: { markupid:{markup} , markupid:{markup}] }\t\r\n*/\r\nvar groupByOffset=function(markups) {\r\n\tvar out={};\r\n\tfor (var id in markups) {\r\n\t\tvar m=markups[id];\r\n\t\tif (!out[m.s]) out[m.s]={};\r\n\t\tout[m.s][id]=m;\r\n\t}\r\n\treturn out;\r\n}\r\n\r\nvar\thasOverlap=function(start,len,markups){\r\n\tfor (var i in markups) {\r\n\t\tvar m=markups[i];\r\n\t\tif (!(m[0]>start+len || m[0]+m[1]<start)) return true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nvar nmarkupAtPos=function(markups,offset) {\r\n    return markups.reduce(function(prev,m){return (m.s===offset)?prev+1:prev },0);\r\n}\r\n\r\n// create minimum spans for overlap markup.\r\n// each span holds an array of markups id in props.mid\r\n// this.spreaded is the starting offset of the text snippnet in the span\r\n// markup other than _select_ (the build in classname for selection)\r\n// with len==0 is same as len==1\r\n\r\nvar spreadMarkup=function(markups){\r\n\tif (!markups) return [];\r\n\tvar out=[];\r\n\tfor (var n in markups) {\r\n\t\tvar m=markups[n];\r\n\t\tfor (var j=m.s;j<m.s+m.l+1;j++) {\r\n\t\t\tif ( (!m.l && m.type!==\"_selected_\") || j<m.s+m.l ) {\r\n\t\t\t\tif (!out[j]) out[j]=[];\r\n\t\t\t\tout[j].push(n);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfor (var i=0;i<out.length;i++) {\r\n\t\tout[i]&&out[i].sort(function(a,b){return a-b});\r\n\t}\r\n\treturn out;\r\n}\r\n\r\nmodule.exports={groupByOffset:groupByOffset,nmarkupAtPos:nmarkupAtPos,\r\n\tspreadMarkup:spreadMarkup,hasOverlap:hasOverlap};",
    "try {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\nvar containerStyle={\r\n\tborderBottom:\"solid 0.1em green\"\r\n}\r\nvar inputStyle={\r\n\t  backgroundColor: \"transparent\",\r\n//\t\ttextDecoration: \"underline\",\r\n    outline:0,\r\n    border:0,\r\n    fontSize:\"100%\",\r\n    fontFamily:\"inherit\",\r\n    color: \"inherit\"\r\n}\r\nvar RevisionEdit=React.createClass({\r\n\tdisplayName:\"RevisionEdit\"\r\n\t,mixins:[PureRenderMixin]\r\n\t,propTypes:{\r\n\t\tediting:PT.bool.isRequired\r\n\t\t,action:PT.func.isRequired\r\n\t}\r\n\t,setCaret:function() {\r\n\t\tvar that=this;\r\n\t\tsetTimeout(function(){\r\n\t\t\tif (!that.refs.input) return;//input destroyed\r\n\t\t\tvar input=that.refs.input.getDOMNode();\t\r\n\t\t\tinput.focus();\r\n\t\t\tclearTimeout(this.blurtimer);\r\n\t\t\tvar val=input.value;\r\n\t\t\tinput.setSelectionRange(val.length,val.length);\r\n\t\t},100);\r\n\t}\r\n\t,onKeyPress:function(e) {\r\n\t\tif (e.key==\"Enter\") {\r\n\t\t\tvar input=this.refs.input.getDOMNode();\r\n\t\t\tthis.props.action(\"setText\",input.value);\t\r\n\t\t}\r\n\t}\r\n\t,componentDidMount:function() {\r\n\t\tthis.setCaret();\r\n\t}\r\n\t,componentDidUpdate:function() {\r\n\t\tif (this.props.editing) this.setCaret();\r\n\t}\t\r\n\t,onFocus:function() {\r\n\t\tif (!this.props.editing)  return;\r\n\t\tclearTimeout(this.blurtimer);\r\n\t}\r\n\t,onBlur:function() {\r\n\t\tif (!this.props.editing)  return;\r\n\t\tvar that=this;\r\n\t\tclearTimeout(this.blurtimer);\r\n\t\tthis.blurtimer=setTimeout(function(){\r\n\t\t\tthat.props.action(\"leave\");\r\n\t\t},500);\r\n\t},\r\n\trender:function() {\r\n\t\tvar size=this.props.markup.l||1;\r\n\t\treturn E(\"span\",{style:containerStyle},E(\"input\",{ref:\"input\",size:size,style:inputStyle,\r\n\t\t\tonKeyPress:this.onKeyPress,onFocus:this.onFocus,onBlur:this.onBlur,\r\n\t\t\tdefaultValue:this.props.markup.t}));\r\n\t}\r\n});\r\nmodule.exports=RevisionEdit;",
    "try {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\n\r\nvar style={fontSize:\"35%\",borderStyle:\"solid\",borderColor:\"gray\",borderRadius:\"25%\",cursor:\"pointer\"};\r\nvar RevisionEditControl=React.createClass({\r\n\tdisplayName:\"RevisionEditControl\"\r\n\t,mixins:[PureRenderMixin]\r\n\t,propTypes:{\r\n\t\tediting:PT.bool.isRequired\r\n\t\t,action:PT.func.isRequired\r\n\t}\r\n\t,caretprev:function() {\r\n\t\tthis.props.action(\"adjustlen\",-1);\r\n\t}\r\n\t,caretnext:function() {\r\n\t\tthis.props.action(\"adjustlen\",1);\r\n\t}\r\n\t,render:function() {\r\n\t\treturn (E(\"span\",{},\r\n\t\t\t\tE(\"a\",{key:\"prev\",onClick:this.caretprev,style:style},\"←\")\r\n\t\t\t\t,E(\"a\",{key:\"next\",onClick:this.caretnext,style:style},\"→\")\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n});\r\n\r\nmodule.exports=RevisionEditControl;",
    "try {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\n\r\nvar IL=require(\"../interline\");\r\nvar RevisionNote=require(\"./note\");\r\nvar RevisionEdit=require(\"./edit\");\r\nvar RevisionEditControl=require(\"./editcontrol\");\r\nvar caretPos=require(\"../caretpos\");\r\n\r\nvar RevisionEditMode=React.createClass({\r\n\tdisplayName:\"RevisionEditMode\"\r\n\t,mixins:[PureRenderMixin]\r\n\t,style:{display:\"none\"}\r\n\t,propTypes:{\r\n\t\tmarkup:PT.object.isRequired\r\n\t\t,mid:PT.string.isRequired\r\n\t\t,context:PT.object.isRequired\r\n\t}\r\n\t,getInitialState:function(){\r\n\t\treturn {editNote:false};\r\n\t}\r\n\t,adjustlen:function(direction) {\r\n\t\tvar m=this.props.markup;\r\n\t\tvar caretpos=caretPos.create(this.props.context.text.substr(m.s));\r\n\t\tvar newlen=direction<0?caretpos.prev(m.l):caretpos.next(m.l);\r\n\t\tthis.action(\"setLength\",newlen);\r\n\t}\r\n\t,action:function(act,p1) {\r\n\t\tif (act===\"editNote\") {\r\n\t\t\tconsole.log(\"editnote\")\r\n\t\t\tthis.setState({editNote:true});\r\n\t\t} else if (act===\"leaveNote\") {\r\n\t\t\tconsole.log(\"leavenote\")\r\n\t\t\tthis.setState({editNote:false});\r\n\t\t} else if (act===\"leave\") {\r\n\t\t\tif (!this.state.editNote) {\r\n\t\t\t\tthis.props.context.action(\"leave\",this.props.mid);\r\n\t\t\t}\r\n\t\t} else if (act===\"setLength\") {\r\n\t\t\tthis.props.context.action(\"setMarkup\",this.props.mid,\"l\",parseInt(p1)||0);\r\n\t\t} else if (act===\"setText\") {\r\n\t\t\tthis.props.context.action(\"setMarkup\",this.props.mid,\"t\",p1);\r\n\t\t\tthis.props.context.action(\"activate\",this.props.mid);\r\n\t\t\tthis.props.context.action(\"leave\",this.props.mid);\r\n\t\t} else if (act===\"setNote\") {\r\n\t\t\tthis.props.context.action(\"setMarkup\",this.props.mid,\"note\",p1);\r\n\t\t} else if (act===\"adjustlen\") {\r\n\t\t\tthis.adjustlen(p1);\r\n\t\t}\r\n\t}\r\n\t,renderNote:function() {\r\n\t\treturn E(RevisionNote,\r\n\t\t\t\t{note:this.props.markup.note,action:this.action,editing:this.state.editNote\r\n\t\t\t\t\t,mid:this.props.mid,activated:this.props.activated},\r\n\t\t\t\tthis.props.markup.note);\r\n\t}\r\n\t,render:function() {\r\n\t\tvar props=update(this.props,{$merge:{\r\n\t\t\tediting:!this.state.editNote,action:this.action}\r\n\t\t});\r\n\t\treturn E(IL.Container,{}\r\n\t\t\t,E(IL.Super, {}, E(RevisionEditControl,props) )\r\n\t\t\t,E(IL.Embed, {}, E(RevisionEdit,props))\r\n\t\t\t,E(IL.Sub  , {}, this.renderNote() )\r\n\t\t\t);\r\n\t}\r\n});\r\nmodule.exports=RevisionEditMode;",
    "var redlinethrough=require(\"./redlinethrough\");\r\nvar linethroughstyle={background:\"url(\"+redlinethrough+\") repeat center\"};\r\n//var linethroughstyle={textDecoration:\"line-through\"};\r\nvar getOldTextStyle=function(markup,mid,context) {\r\n\tvar style={};\r\n\tif (context.hovering===mid) style=linethroughstyle;\r\n\telse if (context.editing===mid) style=linethroughstyle;\r\n\telse if (context.markupActivated[mid]) style={display:\"none\"};\r\n\tif (markup.l==0) style={};\r\n\treturn style;\r\n}\r\nvar defaultActivate=function(markup,group) {\r\n\treturn Object.keys(group).length===1;\r\n}\r\nvar getHandleCaption=function(markup) {\r\n\treturn markup.username||markup.author||\"anonymous\";\r\n}\r\n\r\n//normally click on Super Handle will invoke this.props.onClickTag\r\nvar translateClick=function(mid,activated){\r\n\t return activated?\"deactivate\":\"activate_edit\";\r\n}\r\nmodule.exports={Component:require(\"./revision\"), getStyle:getOldTextStyle , defaultActivate:defaultActivate\r\n,getHandleCaption:getHandleCaption,translateClick:translateClick} ;",
    "try {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\n\r\nvar textareaStyle={top:\"0.6em\",lineHeight:\"100%\",fontSize:\"75%\",position:\"absolute\",outline:\"none\",borderRadius:\"5px\"};\r\nvar staticStyle={fontSize:\"75%\",cursor:\"pointer\"};\r\nvar RevisionNote=React.createClass({\r\n\tdisplayName:\"RevisionNote\"\r\n\t,mixins:[PureRenderMixin]\r\n\t,propTypes:{\r\n\t\taction:PT.func.isRequired\r\n\t\t,mid:PT.string.isRequired\r\n\t\t,editing:PT.bool.isRequired\r\n\t\t,note:PT.string.isRequired\r\n\t}\r\n\t,onBlur:function(){\r\n\t\tthis.props.action(\"setNote\",this.refs.note.getDOMNode().value);\r\n\t\tthis.props.action(\"leaveNote\");\r\n\t}\r\n\t,componentDidUpdate:function() {\r\n\t\tif (!this.props.editing) return;\r\n\t\tvar that=this;\r\n\t\tsetTimeout(function(){\r\n\t\t\t\tthat.refs.note.getDOMNode().focus();\r\n\t\t},200);\r\n\t}\r\n\t,onClick:function() {\r\n\t\tthis.props.action(\"editNote\");\r\n\t}\r\n\t,render:function(){\r\n\r\n\t\tif (this.props.editing) {\r\n\t\t\treturn E(\"textarea\",\r\n\t\t\t\t{rows:4,cols:20,ref:\"note\",onBlur:this.onBlur,style:textareaStyle,\r\n\t\t\t\tdefaultValue:this.props.note}\r\n\t\t\t);\r\n\t\t} else{\r\n\t\t\treturn E(\"span\",{style:staticStyle,onClick:this.onClick},this.props.note||\"...\");\t\r\n\t\t}\r\n\t}\r\n});\r\n\r\nmodule.exports=RevisionNote;",
    "var redline=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACVBMVEUAAADtHCT///+jR4VkAAAAAXRSTlMAQObYZgAAAAFiS0dEAmYLfGQAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAAXSURBVDjLY2AYBcMWhKIBqgiMglGAAAAfDRqRFmX93gAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0wNS0yMFQwNzo1NTo0OCswMjowMCznXDoAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTUtMDUtMjBUMDc6NTU6NDgrMDI6MDBduuSGAAAAAElFTkSuQmCC\";\r\n//var messy=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAKJSURBVGhD1ZhBbtwwDEWdK3Td7Nr7H6jLrpsrTAV8g6OhSJqkKI/yFkWKSvR7jAdB+vF4PI7vzHYBX5+/z6+O48ffP+dXOlsE9NI9+wZoxoRHHdwXcCkN/OpgbYBTGkTVwZIA+51m/5rzJsoCbGlQqw4KAkR1JrdCHSQDPNKN8VihOvAGiMbEW9SBFRCVBuxWwlt8rjaHBxjStsrMyu1NEeLAl4CcROLWpTFNoJPazLUf4h5berzbnzcmxwI0CfEBUeMep33DGzDalEsTNMRz/iLA421IO42JfpTzrhwgOvUTC6UBG+gfwgNGM5pVLg3S6uAM0LwXSYNJdVz/+PfzF/7uYV4a5NTFbV4HVEmDqLooTbTrPKBWtyekrnmPt86Add4Nv7rorZ3HYe8Pshwz6vZO6fySAL9N1LvRX2mHiwNCQuzwpXqD2bc/ywJCNqOHjTG8ICC6yJA9G95gV6YCouoNuhJV185nAi63ouG0D+0lFpBWb3jsQ+ogENBP93sD235mL9cBia0wDPsZdWAFzE8HmMPuzu8FqAH9A9LTQR9QtRRCCChUB6M0KBnOA8rtGyygaix4Bnw7dXAG1Nozb2JVAD1vhTpm1i6o5xkwM1fz7hnPpOmX8vydOBfgUWcUljTyvxMzj1z/CMa2ac7Ol/+VcEoUqoe+G2LVy4f4Hi63q22kv0Vn5J8Dd+L8BpIeO/8M0BC770fTsAI2USfEd0QNcNqLQyexl8WeKAfQIZq1QnQGEhMCoq7lb5dTAM/lAcblctEEvZ4rYAdpoImpH+J9sHe6b8D4Mouvw44BTnWwV0DiE7hFQGjljHcGjN4Nvzp4T8DMyhl3ByTecptbA8R3xomcehz/AYPHXX9v/QOyAAAAAElFTkSuQmCC\";\r\n//var mesh=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAAKCAIAAAARhxgeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAAVSURBVBhXYwCC////gzEEkM5jYAAAFmgd41TlhHAAAAAASUVORK5CYII=\";\r\nmodule.exports=redline;",
    "try {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\n\r\nvar IL=require(\"../interline\");\r\nvar RevisionNote=require(\"./note\");\r\nvar RevisionEditMode=require(\"./editmode\");\r\n\r\nvar authorButtonStyle={\r\n\t\t\tborderStyle:\"solid\",borderColor:\"gray\",fontSize:\"50%\",color:\"silver\",borderWidth:2\r\n\t\t\t,borderRadius:\"20%\",cursor:\"pointer\",verticalAlign:\"top\",\r\n\t\t\tbackgroundColor:\"drakgray\",height:\"0.5em\",width:\"0.5em\"};\r\n\r\nvar AuthorButton=React.createClass({\r\n\tmixins:[PureRenderMixin]\r\n\t,propTypes:{\r\n\t\taction:PT.func.isRequired\r\n\t\t,mid:PT.string.isRequired\r\n\t\t,activated:PT.bool.isRequired\r\n\t\t,editable:PT.bool.isRequired\r\n\t}\r\n\t,activatedStyle: update(authorButtonStyle,{$merge:{borderColor:\"green\"}})\r\n\t,getInitialState:function() {\r\n\t\treturn {style:{}};\r\n\t}\r\n\t,onMouseLeave:function(e) {\r\n\t\tthis.props.action(\"leave\",this.props.mid);\r\n\t}\r\n\t,onClick:function(e) {\r\n\t\tvar act=this.props.activated?\"deactivate\":\"activate_edit\";\r\n\t\tthis.props.action(act,this.props.mid);\r\n\t}\r\n\t,onMouseEnter:function(e) {\r\n\t\tthis.props.action(\"enter\",this.props.mid);\r\n\t}\r\n\t,render:function(){\r\n\t\treturn E(\"span\",{style:this.props.activated?this.activatedStyle:authorButtonStyle,\r\n\t\t\tonMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick},\r\n\t\t\tthis.props.children);\r\n\t}\r\n});\r\n\r\n\r\nvar Revision=React.createClass({\r\n\tdisplayName:\"Revision\"\r\n\t,mixins:[PureRenderMixin]\r\n\t,style:{display:\"none\"}\r\n\t,propTypes:{\r\n\t\tmarkup:PT.object.isRequired\r\n\t\t,mid:PT.string.isRequired\r\n\t\t,context:PT.object.isRequired\r\n\t\t,activated:PT.bool\r\n\t\t,showSuper:PT.bool\r\n\t\t,isHovering:PT.bool\r\n\t\t,isEditing:PT.bool\r\n\t}\r\n\t,renderAuthor:function() {\r\n\t\tif (this.props.showSuper) {\r\n\t\t\treturn E(AuthorButton,\r\n\t\t\t\t{action:this.props.context.action,mid:this.props.mid\r\n\t\t\t\t,activated:this.props.activated,editable:this.props.editable||false},\r\n\t\t\t\tthis.props.markup.username||this.props.markup.author)\r\n\t\t};\r\n\t}\r\n\t,renderNote:function() {\r\n\t\tif(this.props.isHovering) {\r\n\t\t\treturn E(RevisionNote,\r\n\t\t\t\t{editing:false,action:this.props.context.action,note:this.props.markup.note,\r\n\t\t\t\t mid:this.props.mid},\r\n\t\t\t\tthis.props.markup.note);\r\n\t\t};\r\n\t}\r\n\t,getNewTextStyle:function() {\r\n\t\tvar style={display:\"none\"};\r\n\t\tif (this.props.isHovering) style={borderBottom:\"solid 0.1em green\",display:\"inline\"};\r\n\t\telse if (this.props.activated) style={display:\"inline\"};\r\n\t\treturn style;\r\n\t}\r\n\t,render:function() {\r\n\t\tif (this.props.context.editing===this.props.mid) {\r\n\t\t\treturn E(RevisionEditMode,this.props);\r\n\t\t} else {\r\n\t\t return E(IL.Container,{}\r\n\t\t\t,E(IL.Super, {}, this.renderAuthor() )\r\n\t\t\t,E(IL.Embed, {style:this.getNewTextStyle() }, this.props.markup.t)\r\n\t\t\t,E(IL.Sub  , {}, this.renderNote() )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nmodule.exports=Revision;",
    "/*\r\n\tSelect text by mouse or keyboard\r\n*/\r\ntry {\r\n\tvar React=require(\"react-native\");\r\n\tvar PureRenderMixin=null;\r\n} catch(e) {\r\n\tvar React=require(\"react/addons\");\r\n\tvar PureRenderMixin=React.addons.PureRenderMixin;\r\n}\r\nvar update=React.addons.update, E=React.createElement, PT=React.PropTypes;\r\n\r\nvar selectedTextStyle={\"backgroundColor\":\"highlight\",color:\"black\"};\r\n\r\nvar KeyboardMixin=require(\"./keyboard_mixin\");\r\nvar selection=require(\"./selection\");\r\nvar FlattenView=require(\"./flattenview\");\r\nvar textrange=require(\"./textrange\");\r\nvar selection=require(\"./selection\");\r\nvar SelectableView=React.createClass({\r\n\tmixins:[PureRenderMixin,KeyboardMixin]\r\n\t,propTypes:{\r\n\t\tselectable: PT.oneOf(['no', 'single', 'multiple'])\r\n\t\t,showCaret:PT.bool\r\n\t\t,onSelectText: PT.func\r\n\t\t,tags:PT.array\r\n\t\t,selections:PT.array\r\n\t\t,allowKeys:PT.array\r\n\t\t,onMouseUp:PT.func\r\n\t\t,onSpanEnter:PT.func,onSpanLeave:PT.func\r\n\t}\r\n\t,updateSelection:function(tags) {\r\n\t\tvar seltags=this.tagFromSel(tags||this.state.tags,this.ranges.get());\r\n\t\tthis.setState({tags:seltags});\r\n\t}\r\n\t,setSelections:function(props,tags) {\r\n\t\tif (props.selections) {\r\n\t\t\tthis.ranges.set(props.selections);\r\n\t\t\treturn this.updateSelection(tags);\r\n\t\t}\r\n\t}\r\n\t,componentWillMount:function() {\r\n\t\tthis.ranges=textrange.create();\r\n\t\tthis.setSelections(this.props);\r\n\t}\r\n\t,getInitialState:function(){\r\n\t\tvar allowkeys=KeyboardMixin.arrowkeys;\r\n\t\tif (this.props.allowKeys) allowkeys=update(allowkeys,{$push:this.props.allowKeys});\r\n\t\treturn {allowkeys:allowkeys,tags:this.props.tags};\r\n\t}\r\n\t,getDefaultProps:function(){\r\n\t\treturn {showCaret:true,selectable:\"multiple\",tags:[]};\r\n\t}\r\n\t,componentWillReceiveProps:function(nextProps) {\r\n\t\tvar seltags=nextProps.tags;\r\n\t\tif (this.props.selectable!==\"no\") {\r\n\t\t\tseltags=this.tagFromSel(seltags,this.ranges.get());\t\r\n\t\t\tthis.setState({tags:seltags});\r\n\t\t}\r\n\t\tthis.setSelections(nextProps,seltags);\r\n\t}\r\n\t,componentDidMount:function() {\r\n\t\t//turn contentEditable on for caret, cannot set in render as React will give warning\r\n\t\tif (this.props.showCaret) this.getDOMNode().contentEditable=true;\r\n\t}\r\n\t,tagFromSel:function(tags,sels) {\r\n\t\tif (!tags)return;\r\n\t\ttags=tags.filter(function(m){ return m.type!==\"_selected_\";});\r\n\t\tsels.map(function(sel){\r\n\t\t\tif (sel[1]>0) tags.push({s:sel[0],l:sel[1],type:\"_selected_\",style:selectedTextStyle});\r\n\t\t});\r\n\t\treturn tags;\r\n\t}\r\n\t,markSelection:function(start,len,selectedtext,params){\r\n\t\tvar selectable=this.props.selectable;\r\n\t\tif (selectable===\"no\") return;\r\n\r\n\t\tif (selectable===\"multiple\") {\r\n\t\t\tthis.ranges.add(start,len,selectedtext);\t\r\n\t\t} else {\r\n\t\t\tthis.ranges.set([[start,len,selectedtext]]);\t\r\n\t\t}\r\n\r\n\t\tif(this.props.onSelectText){\r\n\t\t\tvar cancel=this.props.onSelectText(start,len,selectedtext,params,this.ranges.get());\r\n\t\t\tif (cancel) {\r\n\t\t\t\t\tthis.ranges.remove(start,len,selectedtext);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tthis.updateSelection(this.state.tags);\r\n\t}\r\n\t,onDoubleClick:function(e) {\r\n\t\tthis.onMouseUp(e);\r\n\t}\r\n\t,removeBlankInselection:function(sel,text) {\r\n\t\tif (text.trim()===\"\") return;\r\n\t\tvar s=0,c=text.charCodeAt(0);\r\n\t\twhile (c<0x21 || (c>=0xf0b && c<=0xf0e)) {\r\n\t\t\tsel.start++;\r\n\t\t\tsel.len--;\r\n\t\t\ttext=text.substr(1);\r\n\t\t\tc=text.charCodeAt(0);\r\n\t\t}\r\n\r\n\t\tvar e=e=text.length-1;\r\n\t\tc=text.charCodeAt(text.length-1);\r\n\t\twhile (c<0x21 || (c>=0xf0b && c<=0xf0e)) {\r\n\t\t\tsel.len--;\r\n\t\t\ttext=text.substr(0,text.length-1);\r\n\t\t\tc=text.charCodeAt(text.length-1);\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\t,onMouseUp:function(e) {\r\n\t\tif (e.target.nodeName!=\"SPAN\") return;\r\n\t\tvar sel=selection.get(this.getDOMNode());\r\n\t\tif (!sel || isNaN(sel.start))return;\r\n\r\n\t\tif (sel.len) sel.selection.empty();\r\n\t\tvar text=this.props.text.substr(sel.start,sel.len||1);\r\n\t\tif (text.charCodeAt(0)>=0xD800 ) { //surrogate\r\n\t\t\ttext=this.props.text.substr(sel.start,sel.len||2);\r\n\t\t}\r\n\t\ttext=this.removeBlankInselection(sel,text);\r\n\t\tvar cancel=sel&&this.markSelection(sel.start,sel.len,text,\r\n\t\t\t{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,sender:this.props.id});\r\n\t\tif (!cancel) this.selection=sel;\r\n\t\tif (sel.len==0) {\r\n\t\t\tthis.caretPos=sel.start;\r\n\t\t}\r\n\t}\r\n\t,setCaretPos:function(domnode,offset) {\r\n\t\tvar range = document.createRange();\r\n\t\tif (offset<0 || offset>domnode.length)return;\r\n\t\trange.setStart(domnode,offset);\r\n\t\trange.setEnd(domnode,offset);\r\n\t\t \r\n\t\tvar sel = window.getSelection(); \r\n\t\tsel.removeAllRanges();\r\n\t\tsel.addRange(range); \r\n\t}\r\n\t,restoreCaret:function(p) {\r\n\t\tvar nodes=this.getDOMNode().childNodes;\r\n\r\n\t\tif (nodes.length===1) {\r\n\t\t\tthis.setCaretPos(nodes[0].childNodes[0],p);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (var i=nodes.length-1;i>0;i--) {\r\n\t\t\tvar start=parseInt(nodes[i].dataset.start);\r\n\t\t\tif (start<=p) {\r\n\t\t\t\toffset=p-start;\r\n\t\t\t\tthis.setCaretPos(nodes[i].childNodes[0],offset);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t,componentDidUpdate:function() {\r\n\t\tif (!this.caretPos) return;\r\n\t\tthis.restoreCaret(this.caretPos);\r\n\t\tthis.caretPos=0;\r\n\t}\r\n\t,onFocus:function(e){\r\n\t}\r\n\t,onBlur:function(e){\r\n\t}\t\r\n\t,render:function(){\r\n\t\tvar props=update(this.props,{$merge:{\r\n\t\t\tonMouseUp:this.onMouseUp\r\n\t\t\t,onClick:this.props.onClick\r\n\t\t\t,onSpanEnter:this.props.onSpanEnter\r\n\t\t\t,onSpanLeave:this.props.onSpanLeave\r\n\t\t\t,onKeyDown:this.props.onKeyDown||this.onkeydown\r\n\t\t\t,onKeyUp:this.props.onKeyUp||this.onkeyup\r\n\t\t\t,onKeyPress:this.props.onKeyPress||this.onkeypress\r\n\t\t\t,onDoubleClick:this.onDoubleClick\r\n\t\t\t,onFocus:this.props.onFocus||this.onFocus\r\n\t\t\t,onBlur:this.props.onBlur||this.onBlur\t\t\t\r\n\t\t\t,tags:this.state.tags\r\n\t\t}});\r\n\t\t\r\n\t\treturn E(FlattenView,props);\r\n\t}\r\n});\r\nmodule.exports=SelectableView;",
    "/**\r\n    Return text position at system caret \r\n    @param {object} DOM node holding the text\r\n    @param {object} baseNode or extendNode node return by system getSelection\r\n    @param {number} offset from the selected node\r\n*/\r\nvar getPos=function(rootele,node,off){\r\n    if (!node) return;\r\n    while (node && node.parentElement!==rootele) node=node.parentElement;\r\n    while (node && !node.dataset.start) node=node.nextSibling;\r\n    if (!node) return -1;\r\n\r\n    var pos=parseInt(node.dataset.start)+off;\r\n    return pos;\r\n}\r\n/**\r\n    Return the span and offset containing the pos (return by getPos)\r\n    @param {array} spans\r\n    @param {number} text position\r\n*/\r\nvar posInSpan=function(children,pos) {\r\n    var lasti;\r\n\tfor (var i=0;i<children.length;i++) {\r\n        if (!children[i].dataset.start)continue;\r\n\t\tvar spanstart=parseInt(children[i].dataset.start);\r\n\t\tif (spanstart>pos) {\r\n\t\t\tlaststart=parseInt(children[lasti].dataset.start);\r\n\t\t\treturn {idx:i-1,element:children[lasti], offset:pos-laststart};\r\n\t\t}\r\n        lasti=i;\r\n\t}\r\n\tlaststart=parseInt(children[children.length-1].dataset.start);\r\n\treturn {idx:children.length-1,element:children[children.length-1], offset:pos-laststart };\r\n}\r\n/**\r\n    Set Caret to a saved selection\r\n*/\r\nvar restore=function(domnode,oldsel) {\r\n    if (!oldsel) return;\r\n\tvar span=posInSpan(domnode.childNodes,oldsel.start+oldsel.len)\r\n    if (!span) return;\r\n    if (!span.element.childNodes[0])return;\r\n\r\n    var range = document.createRange();\r\n    if (span.element.nodeType!==3 && span.element.childNodes[0].nodeType===3) {\r\n    \tspan.element=span.element.childNodes[0];\r\n    }\r\n    if (span.offset>span.element.length) {\r\n        range.setStart(span.element, 0);\r\n        range.setEnd( span.element, 0);\r\n    } else {\r\n        range.setStart(span.element ,span.offset);\r\n        range.setEnd( span.element,span.offset);        \r\n    }\r\n    var sel = window.getSelection();\r\n    sel.removeAllRanges();\r\n    sel.addRange(range);\r\n}\r\n/**\r\n    Get the start and len of current selection\r\n    @param {object} root domnode holding the text\r\n*/\r\nvar get=function(rootele) {\r\n    var sel=window.getSelection();\r\n    if (!sel.baseNode) return;\r\n\r\n    var off=getPos(rootele,sel.anchorNode,sel.anchorOffset);\r\n    var off2=getPos(rootele,sel.focusNode,sel.focusOffset);\r\n\r\n    var p1=sel.anchorNode.parentElement,p2=sel.focusNode.parentElement;\r\n    if (p1.nodeName!=\"SPAN\"||p2.nodeName!=\"SPAN\") return;\r\n\r\n    var start=off,len=off2-off;\r\n    if (len<0) {\r\n        start=off2;\r\n        len=off-off2;\r\n    }\r\n\treturn {start:start,len:len, selection:sel};\r\n}\r\n\r\nmodule.exports={get:get,restore:restore};",
    "/**\r\n\tCombining multiple range\r\n*/\r\nvar create=function() {\r\n\tvar textrange={};\r\n\tvar _ranges=[];\r\n\r\n\tvar removeOverlap=function(start,len) {\r\n\t\tvar overlap=[];\r\n\t\t_ranges=_ranges.filter(function(r){\r\n\t\t\tif (r[0]>start+len || r[0]+r[1]<start) return true;\r\n\t\t\telse {\r\n\t\t\t\toverlap.push(r);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn overlap;\r\n\t}\r\n\tvar combine=function(ranges) {\r\n\t\tvar start=Number.MAX_VALUE,end=0;\r\n\t\tvar text=[];\r\n\t\tfor (var i=0;i<ranges.length;i++) {\r\n\t\t\tvar r=ranges[i];\r\n\r\n\t\t\tfor (var j=r[0];j<r[0]+r[1];j++) {\r\n\t\t\t\tif (!text[j]) text[j]=r[2][j-r[0]]||\"\";\r\n\t\t\t}\r\n\t\t\tif (r[0]<start) start=r[0];\r\n\t\t\tif (r[0]+r[1]>end) end=r[0]+r[1];\r\n\t\t}\r\n\t\tvar t=\"\";\r\n\t\tfor (var i=start;i<end;i++) t+=text[i];\r\n\t\treturn [start,end-start,t];\r\n\t}\r\n\r\n\tvar find=function(start,length) {\r\n\t\tfor (var i=0;i<_ranges.length;i++) {\r\n\t\t\tvar r=_ranges[i];\r\n\t\t\tif (r[0]===start && r[1]===length)return i;\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\tvar add=function(start,len,text) {\r\n\t\tvar text=text||\"\";\r\n\r\n\t\tvar same=find(start,len);\r\n\t\tif (same>-1) {\r\n\t\t\t_ranges.splice(same,1);\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\t\r\n\t\tvar overlap=removeOverlap(start,len);\r\n\r\n\t\tif (overlap.length) {\r\n\t\t\toverlap.push([start,len,text]);\r\n\t\t\tvar combined=combine(overlap);\r\n\t\t\t_ranges.push( combined );\r\n\t\t} else {\r\n\t\t\t_ranges.push([start,len,text]);\t\r\n\t\t}\r\n\t\t_ranges.sort(function(s1,s2){ //sort by start and len\r\n\t\t\treturn (s1[0]==s2[0])?(s1[1]-s2[1]):(s1[0]-s2[0]);\r\n\t\t});\r\n\t}\r\n\tvar get=function() {\r\n\t\treturn _ranges;\r\n\t}\r\n\tvar removeAll=function() {\r\n\t\t_ranges=[];\r\n\t}\r\n\tvar remove=function(start,len,text) {\r\n\t\tvar idx=find(start,len);\r\n\t\tif (idx>-1) {\r\n\t\t\t_ranges.splice(idx,1);\r\n\t\t}\r\n\t}\r\n\tvar set=function(ranges) {\r\n\t\tremoveAll();\r\n\t\tfor (var i=0;i<ranges.length;i++) {\r\n\t\t\tvar r=ranges[i];\r\n\t\t\tadd(r[0],r[1],r[2]);\r\n\t\t}\r\n\t}\r\n\ttextrange.add=add;\r\n\ttextrange.get=get;\r\n\ttextrange.removeAll=removeAll;\r\n\ttextrange.remove=remove;\r\n\ttextrange.set=set;\r\n\ttextrange.find=find;\r\n\r\n\treturn textrange;\r\n}\r\nvar markupInRange=function(markups,ranges) {\r\n\tif (!ranges || !ranges.length) return [];\r\n\tif (typeof ranges[0]===\"number\") ranges=[ranges];\r\n\tif (ranges.length==0) return [];\r\n\tvar out=[];\r\n\tfor (var j=0;j<markups.length;j++) {\r\n\t\tvar m=markups[j];\r\n\t\tfor (var i=0;i<ranges.length;i++) {\r\n\t\t\tvar r=ranges[i];\r\n\t\t\tif (m.s>=r[0] && m.s+m.l<=r[0]+r[1] && out.indexOf(m)===-1) {\r\n\t\t\t\tout.push(m);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\treturn out;\r\n}\r\nmodule.exports={create:create, markupInRange:markupInRange };",
    "var revision=require(\"./revision\");\r\nvar intertext=require(\"./intertext\");\r\nmodule.exports={\"rev\":revision,intertext:intertext};",
    "/*\r\nconvert to pure js\r\nsave -g reactify\r\n*/\r\nvar React=(window&&window.React)||require(\"react\");\r\nvar E=React.createElement;\r\n\r\nvar hasksanagap=(typeof ksanagap!=\"undefined\");\r\nif (hasksanagap && (typeof console==\"undefined\" || typeof console.log==\"undefined\")) {\r\n\t\twindow.console={log:ksanagap.log,error:ksanagap.error,debug:ksanagap.debug,warn:ksanagap.warn};\r\n\t\tconsole.log(\"install console output funciton\");\r\n}\r\n\r\nvar checkfs=function() {\r\n\treturn (navigator && navigator.webkitPersistentStorage) || hasksanagap;\r\n}\r\nvar featurechecks={\r\n\t\"fs\":checkfs\r\n}\r\nvar checkbrowser = React.createClass({\r\n\tgetInitialState:function() {\r\n\r\n\t\tvar missingFeatures=this.getMissingFeatures();\r\n\t\treturn {ready:false, missing:missingFeatures};\r\n\t},\r\n\tgetMissingFeatures:function() {\r\n\t\tvar feature=this.props.feature.split(\",\");\r\n\t\tvar status=[];\r\n\t\tfeature.map(function(f){\r\n\t\t\tvar checker=featurechecks[f];\r\n\t\t\tif (checker) checker=checker();\r\n\t\t\tstatus.push([f,checker]);\r\n\t\t});\r\n\t\treturn status.filter(function(f){return !f[1]});\r\n\t},\r\n\tdownloadbrowser:function() {\r\n\t\twindow.location=\"https://www.google.com/chrome/\"\r\n\t},\r\n\trenderMissing:function() {\r\n\t\tvar showMissing=function(m) {\r\n\t\t\treturn E(\"div\", null, m);\r\n\t\t}\r\n\t\treturn (\r\n\t\t E(\"div\", {ref: \"dialog1\", className: \"modal fade\", \"data-backdrop\": \"static\"}, \r\n\t\t    E(\"div\", {className: \"modal-dialog\"}, \r\n\t\t      E(\"div\", {className: \"modal-content\"}, \r\n\t\t        E(\"div\", {className: \"modal-header\"}, \r\n\t\t          E(\"button\", {type: \"button\", className: \"close\", \"data-dismiss\": \"modal\", \"aria-hidden\": \"true\"}, \"×\"), \r\n\t\t          E(\"h4\", {className: \"modal-title\"}, \"Browser Check\")\r\n\t\t        ), \r\n\t\t        E(\"div\", {className: \"modal-body\"}, \r\n\t\t          E(\"p\", null, \"Sorry but the following feature is missing\"), \r\n\t\t          this.state.missing.map(showMissing)\r\n\t\t        ), \r\n\t\t        E(\"div\", {className: \"modal-footer\"}, \r\n\t\t          E(\"button\", {onClick: this.downloadbrowser, type: \"button\", className: \"btn btn-primary\"}, \"Download Google Chrome\")\r\n\t\t        )\r\n\t\t      )\r\n\t\t    )\r\n\t\t  )\r\n\t\t );\r\n\t},\r\n\trenderReady:function() {\r\n\t\treturn E(\"span\", null, \"browser ok\")\r\n\t},\r\n\trender:function(){\r\n\t\treturn  (this.state.missing.length)?this.renderMissing():this.renderReady();\r\n\t},\r\n\tcomponentDidMount:function() {\r\n\t\tif (!this.state.missing.length) {\r\n\t\t\tthis.props.onReady();\r\n\t\t} else {\r\n\t\t\t$(this.refs.dialog1.getDOMNode()).modal('show');\r\n\t\t}\r\n\t}\r\n});\r\n\r\nmodule.exports=checkbrowser;",
    "\r\nvar userCancel=false;\r\nvar files=[];\r\nvar totalDownloadByte=0;\r\nvar targetPath=\"\";\r\nvar tempPath=\"\";\r\nvar nfile=0;\r\nvar baseurl=\"\";\r\nvar result=\"\";\r\nvar downloading=false;\r\nvar startDownload=function(dbid,_baseurl,_files) { //return download id\r\n\tvar fs     = require(\"fs\");\r\n\tvar path   = require(\"path\");\r\n\r\n\t\r\n\tfiles=_files.split(\"\\uffff\");\r\n\tif (downloading) return false; //only one session\r\n\tuserCancel=false;\r\n\ttotalDownloadByte=0;\r\n\tnextFile();\r\n\tdownloading=true;\r\n\tbaseurl=_baseurl;\r\n\tif (baseurl[baseurl.length-1]!='/')baseurl+='/';\r\n\ttargetPath=ksanagap.rootPath+dbid+'/';\r\n\ttempPath=ksanagap.rootPath+\".tmp/\";\r\n\tresult=\"\";\r\n\treturn true;\r\n}\r\n\r\nvar nextFile=function() {\r\n\tsetTimeout(function(){\r\n\t\tif (nfile==files.length) {\r\n\t\t\tnfile++;\r\n\t\t\tendDownload();\r\n\t\t} else {\r\n\t\t\tdownloadFile(nfile++);\t\r\n\t\t}\r\n\t},100);\r\n}\r\n\r\nvar downloadFile=function(nfile) {\r\n\tvar url=baseurl+files[nfile];\r\n\tvar tmpfilename=tempPath+files[nfile];\r\n\tvar mkdirp = require(\"./mkdirp\");\r\n\tvar fs     = require(\"fs\");\r\n\tvar http   = require(\"http\");\r\n\r\n\tmkdirp.sync(path.dirname(tmpfilename));\r\n\tvar writeStream = fs.createWriteStream(tmpfilename);\r\n\tvar datalength=0;\r\n\tvar request = http.get(url, function(response) {\r\n\t\tresponse.on('data',function(chunk){\r\n\t\t\twriteStream.write(chunk);\r\n\t\t\ttotalDownloadByte+=chunk.length;\r\n\t\t\tif (userCancel) {\r\n\t\t\t\twriteStream.end();\r\n\t\t\t\tsetTimeout(function(){nextFile();},100);\r\n\t\t\t}\r\n\t\t});\r\n\t\tresponse.on(\"end\",function() {\r\n\t\t\twriteStream.end();\r\n\t\t\tsetTimeout(function(){nextFile();},100);\r\n\t\t});\r\n\t});\r\n}\r\n\r\nvar cancelDownload=function() {\r\n\tuserCancel=true;\r\n\tendDownload();\r\n}\r\nvar verify=function() {\r\n\treturn true;\r\n}\r\nvar endDownload=function() {\r\n\tnfile=files.length+1;//stop\r\n\tresult=\"cancelled\";\r\n\tdownloading=false;\r\n\tif (userCancel) return;\r\n\tvar fs     = require(\"fs\");\r\n\tvar mkdirp = require(\"./mkdirp\");\r\n\r\n\tfor (var i=0;i<files.length;i++) {\r\n\t\tvar targetfilename=targetPath+files[i];\r\n\t\tvar tmpfilename   =tempPath+files[i];\r\n\t\tmkdirp.sync(path.dirname(targetfilename));\r\n\t\tfs.renameSync(tmpfilename,targetfilename);\r\n\t}\r\n\tif (verify()) {\r\n\t\tresult=\"success\";\r\n\t} else {\r\n\t\tresult=\"error\";\r\n\t}\r\n}\r\n\r\nvar downloadedByte=function() {\r\n\treturn totalDownloadByte;\r\n}\r\nvar doneDownload=function() {\r\n\tif (nfile>files.length) return result;\r\n\telse return \"\";\r\n}\r\nvar downloadingFile=function() {\r\n\treturn nfile-1;\r\n}\r\n\r\nvar downloader={startDownload:startDownload, downloadedByte:downloadedByte,\r\n\tdownloadingFile:downloadingFile, cancelDownload:cancelDownload,doneDownload:doneDownload};\r\nmodule.exports=downloader;",
    "/* todo , optional kdb */\r\nvar React=(window&&window.React)||require(\"react\");\r\nvar HtmlFS=require(\"./htmlfs\");\r\nvar html5fs=require(\"./html5fs\");\r\nvar CheckBrowser=require(\"./checkbrowser\");\r\nvar E=React.createElement;\r\n\r\n\r\nvar FileList=null;\r\n\r\n/*TODO kdb check version*/\r\nvar Filemanager = React.createClass({\r\n\tgetInitialState:function() {\r\n\t\tvar quota=this.getQuota();\r\n\t\treturn {browserReady:false,noupdate:true,\trequestQuota:quota,remain:0};\r\n\t},\r\n\tcomponentWillMount:function(){\r\n\t  if (ksanagap.bootopts.material) FileList=require(\"./filelist_mui\");\r\n\t  else FileList=require(\"./filelist\");\r\n\t},\r\n\tgetQuota:function() {\r\n\t\tvar q=this.props.quota||\"128M\";\r\n\t\tvar unit=q[q.length-1];\r\n\t\tvar times=1;\r\n\t\tif (unit==\"M\") times=1024*1024;\r\n\t\telse if (unit=\"K\") times=1024;\r\n\t\treturn parseInt(q) * times;\r\n\t},\r\n\tmissingKdb:function() {\r\n\t\tif (ksanagap.platform!=\"chrome\") return [];\r\n\t\tvar missing=this.props.needed.filter(function(kdb){\r\n\t\t\tfor (var i in html5fs.files) {\r\n\t\t\t\tif (html5fs.files[i][0]==kdb.filename) return false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},this);\r\n\t\treturn missing;\r\n\t},\r\n\tgetRemoteUrl:function(fn) {\r\n\t\tvar f=this.props.needed.filter(function(f){return f.filename==fn});\r\n\t\tif (f.length ) return f[0].url;\r\n\t},\r\n\tgenFileList:function(existing,missing){\r\n\t\tvar out=[];\r\n\t\tfor (var i in existing) {\r\n\t\t\tvar url=this.getRemoteUrl(existing[i][0]);\r\n\t\t\tout.push({filename:existing[i][0], url :url, ready:true });\r\n\t\t}\r\n\t\tfor (var i in missing) {\r\n\t\t\tout.push(missing[i]);\r\n\t\t}\r\n\t\treturn out;\r\n\t},\r\n\treload:function() {\r\n\t\thtml5fs.readdir(function(files){\r\n  \t\t\tthis.setState({files:this.genFileList(files,this.missingKdb())});\r\n  \t\t},this);\r\n\t },\r\n\tdeleteFile:function(fn) {\r\n\t  html5fs.rm(fn,function(){\r\n\t  \tthis.reload();\r\n\t  },this);\r\n\t},\r\n\tonQuoteOk:function(quota,usage) {\r\n\t\tif (ksanagap.platform!=\"chrome\") {\r\n\t\t\t//console.log(\"onquoteok\");\r\n\t\t\tthis.setState({noupdate:true,missing:[],files:[],autoclose:true\r\n\t\t\t\t,quota:quota,remain:quota-usage,usage:usage});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//console.log(\"quote ok\");\r\n\t\tvar files=this.genFileList(html5fs.files,this.missingKdb());\r\n\t\tvar that=this;\r\n\t\tthat.checkIfUpdate(files,function(hasupdate) {\r\n\t\t\tvar missing=this.missingKdb();\r\n\t\t\tvar autoclose=this.props.autoclose;\r\n\t\t\tif (missing.length) autoclose=false;\r\n\t\t\tthat.setState({autoclose:autoclose,\r\n\t\t\t\tquota:quota,usage:usage,files:files,\r\n\t\t\t\tmissing:missing,\r\n\t\t\t\tnoupdate:!hasupdate,\r\n\t\t\t\tremain:quota-usage});\r\n\t\t});\r\n\t},  \r\n\tonBrowserOk:function() {\r\n\t  this.totalDownloadSize();\r\n\r\n\t}, \r\n\tdismiss:function() {\r\n\t\tthis.props.onReady(this.state.usage,this.state.quota);\r\n\t\t\r\n\t\tsetTimeout(function(){\r\n\t\t\tif (typeof $ !== \"undefined\") {\r\n\t\t\t\tvar modalin=$(\".modal.in\");\r\n\t\t\t\tif (modalin.modal) modalin.modal('hide');\t\t\t\t\r\n\t\t\t}\r\n\t\t},500);\r\n\t}, \r\n\r\n\ttotalDownloadSize:function() {\r\n\t\tvar files=this.missingKdb();\r\n\t\tvar taskqueue=[],totalsize=0;\r\n\t\tfor (var i=0;i<files.length;i++) {\r\n\t\t\ttaskqueue.push(\r\n\t\t\t\t(function(idx){\r\n\t\t\t\t\treturn (function(data){\r\n\t\t\t\t\t\tif (!(typeof data=='object' && data.__empty)) totalsize+=data;\r\n\t\t\t\t\t\thtml5fs.getDownloadSize(files[idx].url,taskqueue.shift());\r\n\t\t\t\t\t});\r\n\t\t\t\t})(i)\r\n\t\t\t);\r\n\t\t}\r\n\t\tvar that=this;\r\n\t\ttaskqueue.push(function(data){\t\r\n\t\t\ttotalsize+=data;\r\n\t\t\tsetTimeout(function(){that.setState({requireSpace:totalsize,browserReady:true})},0);\r\n\t\t});\r\n\t\ttaskqueue.shift()({__empty:true});\r\n\t},\r\n\tcheckIfUpdate:function(files,cb) {\r\n\t\tvar taskqueue=[];\r\n\t\tfor (var i=0;i<files.length;i++) {\r\n\t\t\ttaskqueue.push(\r\n\t\t\t\t(function(idx){\r\n\t\t\t\t\treturn (function(data){\r\n\t\t\t\t\t\tif (!(typeof data=='object' && data.__empty)) files[idx-1].hasUpdate=data;\r\n\t\t\t\t\t\thtml5fs.checkUpdate(files[idx].url,files[idx].filename,taskqueue.shift());\r\n\t\t\t\t\t});\r\n\t\t\t\t})(i)\r\n\t\t\t);\r\n\t\t}\r\n\t\tvar that=this;\r\n\t\ttaskqueue.push(function(data){\t\r\n\t\t\tif (files.length) files[files.length-1].hasUpdate=data;\r\n\t\t\tvar hasupdate=files.some(function(f){return f.hasUpdate});\r\n\t\t\tif (cb) cb.apply(that,[hasupdate]);\r\n\t\t});\r\n\t\ttaskqueue.shift()({__empty:true});\r\n\t},\r\n\trender:function(){\r\n    \t\tif (!this.state.browserReady) {   \r\n      \t\t\treturn E(CheckBrowser, {feature: \"fs\", onReady: this.onBrowserOk})\r\n    \t\t} if (!this.state.quota || this.state.remain<this.state.requireSpace) {  \r\n    \t\t\tvar quota=this.state.requestQuota;\r\n    \t\t\tif (this.state.usage+this.state.requireSpace>quota) {\r\n    \t\t\t\tquota=(this.state.usage+this.state.requireSpace)*1.5;\r\n    \t\t\t}\r\n      \t\t\treturn E(HtmlFS, {quota: quota, autoclose: \"true\", onReady: this.onQuoteOk})\r\n      \t\t} else {\r\n\t\t\tif (!this.state.noupdate || this.missingKdb().length || !this.state.autoclose) {\r\n\t\t\t\tvar remain=Math.round((this.state.usage/this.state.quota)*100);\t\t\t\t\r\n\t\t\t\treturn E(FileList, {action: this.action, files: this.state.files, remainPercent: remain})\r\n\t\t\t} else {\r\n\t\t\t\tsetTimeout( this.dismiss ,0);\r\n\t\t\t\treturn E(\"span\", null, \"Success\");\r\n\t\t\t}\r\n      \t\t}\r\n\t},\r\n\taction:function() {\r\n\t  var args = Array.prototype.slice.call(arguments);\r\n\t  var type=args.shift();\r\n\t  var res=null, that=this;\r\n\t  if (type==\"delete\") {\r\n\t    this.deleteFile(args[0]);\r\n\t  }  else if (type==\"reload\") {\r\n\t  \tthis.reload();\r\n\t  } else if (type==\"dismiss\") {\r\n\t  \tthis.dismiss();\r\n\t  }\r\n\t}\r\n});\r\n\r\nmodule.exports=Filemanager;",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar html5fs=require(\"./html5fs\");\r\nvar FileList = React.createClass({\r\n\tgetInitialState:function() {\r\n\t\treturn {downloading:false,progress:0};\r\n\t},\r\n\tupdatable:function(f) {\r\n        var classes=\"btn btn-warning\";\r\n        if (this.state.downloading) classes+=\" disabled\";\r\n\t\tif (f.hasUpdate) return   E(\"button\", {className: classes, \r\n\t\t\t\"data-filename\": f.filename, \"data-url\": f.url, \r\n\t            onClick: this.download\r\n\t       }, \"Update\")\r\n\t\telse return null;\r\n\t},\r\n\tshowLocal:function(f) {\r\n        var classes=\"btn btn-danger\";\r\n        if (this.state.downloading) classes+=\" disabled\";\r\n\t  return E(\"tr\", null, E(\"td\", null, f.filename), \r\n\t      E(\"td\", null), \r\n\t      E(\"td\", {className: \"pull-right\"}, \r\n\t      this.updatable(f), E(\"button\", {className: classes, \r\n\t               onClick: this.deleteFile, \"data-filename\": f.filename}, \"Delete\")\r\n\t        \r\n\t      )\r\n\t  )\r\n\t},  \r\n\tshowRemote:function(f) { \r\n\t  var classes=\"btn btn-warning\";\r\n\t  if (this.state.downloading) classes+=\" disabled\";\r\n\t  return (E(\"tr\", {\"data-id\": f.filename}, E(\"td\", null, \r\n\t      f.filename), \r\n\t      E(\"td\", null, f.desc), \r\n\t      E(\"td\", null, \r\n\t      E(\"button\", {\"data-filename\": f.filename, \"data-url\": f.url, \r\n\t            className: classes, \r\n\t            onClick: this.download}, \"Download\")\r\n\t      )\r\n\t  ));\r\n\t},\r\n\tshowFile:function(f) {\r\n\t//\treturn <span data-id={f.filename}>{f.url}</span>\r\n\t\treturn (f.ready)?this.showLocal(f):this.showRemote(f);\r\n\t},\r\n\treloadDir:function() {\r\n\t\tthis.props.action(\"reload\");\r\n\t},\r\n\tdownload:function(e) {\r\n\t\tvar url=e.target.dataset[\"url\"];\r\n\t\tvar filename=e.target.dataset[\"filename\"];\r\n\t\tthis.setState({downloading:true,progress:0,url:url});\r\n\t\tthis.userbreak=false;\r\n\t\thtml5fs.download(url,filename,function(){\r\n\t\t\tthis.reloadDir();\r\n\t\t\tthis.setState({downloading:false,progress:1});\r\n\t\t\t},function(progress,total){\r\n\t\t\t\tif (progress==0) {\r\n\t\t\t\t\tthis.setState({message:\"total \"+total})\r\n\t\t\t \t}\r\n\t\t\t \tthis.setState({progress:progress});\r\n\t\t\t \t//if user press abort return true\r\n\t\t\t \treturn this.userbreak;\r\n\t\t\t}\r\n\t\t,this);\r\n\t},\r\n\tdeleteFile:function( e) {\r\n\t\tvar filename=e.target.attributes[\"data-filename\"].value;\r\n\t\tthis.props.action(\"delete\",filename);\r\n\t},\r\n\tallFilesReady:function(e) {\r\n\t\treturn this.props.files.every(function(f){ return f.ready});\r\n\t},\r\n\tdismiss:function() {\r\n\t\t$(this.refs.dialog1.getDOMNode()).modal('hide');\r\n\t\tthis.props.action(\"dismiss\");\r\n\t},\r\n\tabortdownload:function() {\r\n\t\tthis.userbreak=true;\r\n\t},\r\n\tshowProgress:function() {\r\n\t     if (this.state.downloading) {\r\n\t      var progress=Math.round(this.state.progress*100);\r\n\t      return (\r\n\t      \tE(\"div\", null, \r\n\t      \t\"Downloading from \", this.state.url, \r\n\t      E(\"div\", {key: \"progress\", className: \"progress col-md-8\"}, \r\n\t          E(\"div\", {className: \"progress-bar\", role: \"progressbar\", \r\n\t              \"aria-valuenow\": progress, \"aria-valuemin\": \"0\", \r\n\t              \"aria-valuemax\": \"100\", style: {width: progress+\"%\"}}, \r\n\t            progress, \"%\"\r\n\t          )\r\n\t        ), \r\n\t        E(\"button\", {onClick: this.abortdownload, \r\n\t        \tclassName: \"btn btn-danger col-md-4\"}, \"Abort\")\r\n\t        )\r\n\t        );\r\n\t      } else {\r\n\t      \t\tif ( this.allFilesReady() ) {\r\n\t      \t\t\treturn E(\"button\", {onClick: this.dismiss, className: \"btn btn-success\"}, \"Ok\")\r\n\t      \t\t} else return null;\r\n\t      \t\t\r\n\t      }\r\n\t},\r\n\tshowUsage:function() {\r\n\t\tvar percent=this.props.remainPercent;\r\n           return (E(\"div\", null, E(\"span\", {className: \"pull-left\"}, \"Usage:\"), E(\"div\", {className: \"progress\"}, \r\n\t\t  E(\"div\", {className: \"progress-bar progress-bar-success progress-bar-striped\", role: \"progressbar\", style: {width: percent+\"%\"}}, \r\n\t\t    \tpercent+\"%\"\r\n\t\t  )\r\n\t\t)));\r\n\t},\r\n\trender:function() {\r\n\t  \treturn (\r\n\t\tE(\"div\", {ref: \"dialog1\", className: \"modal fade\", \"data-backdrop\": \"static\"}, \r\n\t\t    E(\"div\", {className: \"modal-dialog\"}, \r\n\t\t      E(\"div\", {className: \"modal-content\"}, \r\n\t\t        E(\"div\", {className: \"modal-header\"}, \r\n\t\t          E(\"h4\", {className: \"modal-title\"}, \"File Installer\")\r\n\t\t        ), \r\n\t\t        E(\"div\", {className: \"modal-body\"}, \r\n\t\t        \tE(\"table\", {className: \"table\"}, \r\n\t\t        \tE(\"tbody\", null, \r\n\t\t          \tthis.props.files.map(this.showFile)\r\n\t\t          \t)\r\n\t\t          )\r\n\t\t        ), \r\n\t\t        E(\"div\", {className: \"modal-footer\"}, \r\n\t\t        \tthis.showUsage(), \r\n\t\t           this.showProgress()\r\n\t\t        )\r\n\t\t      )\r\n\t\t    )\r\n\t\t  )\r\n\t\t);\r\n\t},\t\r\n\tcomponentDidMount:function() {\r\n\t\t$(this.refs.dialog1.getDOMNode()).modal('show');\r\n\t}\r\n});\r\n\r\nmodule.exports=FileList;",
    "var React=require(\"react\");\r\n//var mui=require(\"material-ui\");\r\nvar E=React.createElement;\r\nvar html5fs=require(\"./html5fs\");\r\n\r\nvar FileList = React.createClass({\r\n\tgetInitialState:function() {\r\n\t\treturn {downloading:false,progress:0};\r\n\t},\r\n\tupdatable:function(f) {\r\n        var classes=\"btn btn-warning\";\r\n        if (this.state.downloading) classes+=\" disabled\";\r\n\t\tif (f.hasUpdate) return   E(\"button\", {className: classes, \r\n\t\t\t\"data-filename\": f.filename, \"data-url\": f.url, \r\n\t            onClick: this.download\r\n\t       }, \"Update\")\r\n\t\telse return null;\r\n\t},\r\n\tshowLocal:function(f) {\r\n        var classes=\"btn btn-danger\";\r\n        if (this.state.downloading) classes+=\" disabled\";\r\n\t  return E(\"tr\", null, E(\"td\", null, f.filename), \r\n\t      E(\"td\", null), \r\n\t      E(\"td\", {className: \"pull-right\"}, \r\n\t      this.updatable(f), E(\"button\", {className: classes, \r\n\t               onClick: this.deleteFile, \"data-filename\": f.filename}, \"Delete\")\r\n\t        \r\n\t      )\r\n\t  )\r\n\t},  \r\n\tshowRemote:function(f) { \r\n\t  var classes=\"btn btn-warning\";\r\n\t  if (this.state.downloading) classes+=\" disabled\";\r\n\t  return (E(\"tr\", {\"data-id\": f.filename}, E(\"td\", null, \r\n\t      f.filename), \r\n\t      E(\"td\", null, f.desc), \r\n\t      E(\"td\", null, \r\n\t      E(\"button\", {\"data-filename\": f.filename, \"data-url\": f.url, \r\n\t            className: classes, \r\n\t            onClick: this.download}, \"Download\")\r\n\t      )\r\n\t  ));\r\n\t},\r\n\tshowFile:function(f) {\r\n\t//\treturn <span data-id={f.filename}>{f.url}</span>\r\n\t\treturn (f.ready)?this.showLocal(f):this.showRemote(f);\r\n\t},\r\n\treloadDir:function() {\r\n\t\tthis.props.action(\"reload\");\r\n\t},\r\n\tdownload:function(e) {\r\n\t\tvar url=e.target.dataset[\"url\"];\r\n\t\tvar filename=e.target.dataset[\"filename\"];\r\n\t\tthis.setState({downloading:true,progress:0,url:url});\r\n\t\tthis.userbreak=false;\r\n\t\thtml5fs.download(url,filename,function(){\r\n\t\t\tthis.reloadDir();\r\n\t\t\tthis.setState({downloading:false,progress:1});\r\n\t\t\t},function(progress,total){\r\n\t\t\t\tif (progress==0) {\r\n\t\t\t\t\tthis.setState({message:\"total \"+total})\r\n\t\t\t \t}\r\n\t\t\t \tthis.setState({progress:progress});\r\n\t\t\t \t//if user press abort return true\r\n\t\t\t \treturn this.userbreak;\r\n\t\t\t}\r\n\t\t,this);\r\n\t},\r\n\tdeleteFile:function( e) {\r\n\t\tvar filename=e.target.attributes[\"data-filename\"].value;\r\n\t\tthis.props.action(\"delete\",filename);\r\n\t},\r\n\tallFilesReady:function(e) {\r\n\t\treturn this.props.files.every(function(f){ return f.ready});\r\n\t},\r\n\tabortdownload:function() {\r\n\t\tthis.userbreak=true;\r\n\t},\r\n\tshowProgress:function() {\r\n\t     if (this.state.downloading) {\r\n\t      var progress=Math.round(this.state.progress*100);\r\n\t      return (\r\n\t      \tE(\"div\", null, \r\n\t      \t\"Downloading from \", this.state.url, \r\n\t      E(\"div\", {key: \"progress\", className: \"progress col-md-8\"}, \r\n\t          E(\"div\", {className: \"progress-bar\", role: \"progressbar\", \r\n\t              \"aria-valuenow\": progress, \"aria-valuemin\": \"0\", \r\n\t              \"aria-valuemax\": \"100\", style: {width: progress+\"%\"}}, \r\n\t            progress, \"%\"\r\n\t          )\r\n\t        ), \r\n\t        E(\"button\", {onClick: this.abortdownload, \r\n\t        \tclassName: \"btn btn-danger col-md-4\"}, \"Abort\")\r\n\t        )\r\n\t        );\r\n\t      } else {\r\n\t      \t\tif ( this.allFilesReady() ) {\r\n\t      \t\t\treturn E(\"button\", {onClick: this.dismiss, className: \"btn btn-success\"}, \"Ok\")\r\n\t      \t\t} else return null;\r\n\t      \t\t\r\n\t      }\r\n\t},\r\n\tshowUsage:function() {\r\n\t\tvar percent=this.props.remainPercent;\r\n        return E(\"span\", null,  \"remaining space \"+percent+\"%\");\r\n\t},\r\n\tonToggle:function(e,idx,toggle) {\r\n\t\tconsole.log(\"toggle\",idx);\r\n\t}\r\n\t,buildmenuitems:function(files) {\r\n\t\tvar out=[];\r\n\t\tfor (var i=0;i<files.length;i++) {\r\n\t\t\tvar f=files[i];\r\n\t\t\t\r\n\t\t\tout.push({\r\n\t\t\t\t\tpayload:i,\r\n\t\t\t\t\ttext:this.showFile(f),\r\n\t\t\t\t\ttoggle:true, defaultToggled: f.ready\r\n\t\t\t\t});\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\t,render:function() {\r\n\t  \treturn (\r\n\t\tE(\"div\", {ref: \"dialog1\", className: \"modal fade\", \"data-backdrop\": \"static\"}, \r\n\t\t    E(\"div\", {className: \"modal-dialog\"}, \r\n\t\t      E(\"div\", {className: \"modal-content\"}, \r\n\t\t        E(\"div\", {className: \"modal-header\"}, \r\n\t\t          E(\"h4\", {className: \"modal-title\"}, \"File Installer\")\r\n\t\t        ), \r\n\t\t        E(\"div\", {className: \"modal-body\"}, \r\n\t\t        \tE(\"table\", {className: \"table\"}, \r\n\t\t        \tE(\"tbody\", null, \r\n\t\t          \tthis.props.files.map(this.showFile)\r\n\t\t          \t)\r\n\t\t          )\r\n\t\t        ), \r\n\t\t        E(\"div\", {className: \"modal-footer\"}, \r\n\t\t        \tthis.showUsage(), \r\n\t\t           this.showProgress()\r\n\t\t        )\r\n\t\t      )\r\n\t\t    )\r\n\t\t  )\r\n\t\t);\r\n\t},\t\r\n\tcomponentDidMount:function() {\r\n\t}\r\n});\r\n\r\nmodule.exports=FileList;",
    "/* emulate filesystem on html5 browser */\r\nvar get_head=function(url,field,cb){\r\n\tvar xhr = new XMLHttpRequest();\r\n\txhr.open(\"HEAD\", url, true);\r\n\txhr.onreadystatechange = function() {\r\n\t\t\tif (this.readyState == this.DONE) {\r\n\t\t\t\tcb(xhr.getResponseHeader(field));\r\n\t\t\t} else {\r\n\t\t\t\tif (this.status!==200&&this.status!==206) {\r\n\t\t\t\t\tcb(\"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t};\r\n\txhr.send();\r\n}\r\nvar get_date=function(url,cb) {\r\n\tget_head(url,\"Last-Modified\",function(value){\r\n\t\tcb(value);\r\n\t});\r\n}\r\nvar get_size=function(url, cb) {\r\n\tget_head(url,\"Content-Length\",function(value){\r\n\t\tcb(parseInt(value));\r\n\t});\r\n};\r\nvar checkUpdate=function(url,fn,cb) {\r\n\tif (!url) {\r\n\t\tcb(false);\r\n\t\treturn;\r\n\t}\r\n\tget_date(url,function(d){\r\n\t\tAPI.fs.root.getFile(fn, {create: false, exclusive: false}, function(fileEntry) {\r\n\t\t\tfileEntry.getMetadata(function(metadata){\r\n\t\t\t\tvar localDate=Date.parse(metadata.modificationTime);\r\n\t\t\t\tvar urlDate=Date.parse(d);\r\n\t\t\t\tcb(urlDate>localDate);\r\n\t\t\t});\r\n\t\t},function(){\r\n\t\t\tcb(false);\r\n\t\t});\r\n\t});\r\n}\r\nvar download=function(url,fn,cb,statuscb,context) {\r\n\t var totalsize=0,batches=null,written=0;\r\n\t var fileEntry=0, fileWriter=0;\r\n\t var createBatches=function(size) {\r\n\t\tvar bytes=1024*1024, out=[];\r\n\t\tvar b=Math.floor(size / bytes);\r\n\t\tvar last=size %bytes;\r\n\t\tfor (var i=0;i<=b;i++) {\r\n\t\t\tout.push(i*bytes);\r\n\t\t}\r\n\t\tout.push(b*bytes+last);\r\n\t\treturn out;\r\n\t }\r\n\t var finish=function() {\r\n\t\t rm(fn,function(){\r\n\t\t\t\tfileEntry.moveTo(fileEntry.filesystem.root, fn,function(){\r\n\t\t\t\t\tsetTimeout( cb.bind(context,false) , 0) ;\r\n\t\t\t\t},function(e){\r\n\t\t\t\t\tconsole.log(\"failed\",e)\r\n\t\t\t\t});\r\n\t\t },this);\r\n\t };\r\n\t\tvar tempfn=\"temp.kdb\";\r\n\t\tvar batch=function(b) {\r\n\t\tvar abort=false;\r\n\t\tvar xhr = new XMLHttpRequest();\r\n\t\tvar requesturl=url+\"?\"+Math.random();\r\n\t\txhr.open('get', requesturl, true);\r\n\t\txhr.setRequestHeader('Range', 'bytes='+batches[b]+'-'+(batches[b+1]-1));\r\n\t\txhr.responseType = 'blob';\r\n\t\txhr.addEventListener('load', function() {\r\n\t\t\tvar blob=this.response;\r\n\t\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\t\tfileWriter.seek(fileWriter.length);\r\n\t\t\t\tfileWriter.write(blob);\r\n\t\t\t\twritten+=blob.size;\r\n\t\t\t\tfileWriter.onwriteend = function(e) {\r\n\t\t\t\t\tif (statuscb) {\r\n\t\t\t\t\t\tabort=statuscb.apply(context,[ fileWriter.length / totalsize,totalsize ]);\r\n\t\t\t\t\t\tif (abort) setTimeout( cb.bind(context,false) , 0) ;\r\n\t\t\t\t \t}\r\n\t\t\t\t\tb++;\r\n\t\t\t\t\tif (!abort) {\r\n\t\t\t\t\t\tif (b<batches.length-1) setTimeout(batch.bind(context,b),0);\r\n\t\t\t\t\t\telse                    finish();\r\n\t\t\t\t \t}\r\n\t\t\t \t};\r\n\t\t\t}, console.error);\r\n\t\t},false);\r\n\t\txhr.send();\r\n\t}\r\n\r\n\tget_size(url,function(size){\r\n\t\ttotalsize=size;\r\n\t\tif (!size) {\r\n\t\t\tif (cb) cb.apply(context,[false]);\r\n\t\t} else {//ready to download\r\n\t\t\trm(tempfn,function(){\r\n\t\t\t\t batches=createBatches(size);\r\n\t\t\t\t if (statuscb) statuscb.apply(context,[ 0, totalsize ]);\r\n\t\t\t\t API.fs.root.getFile(tempfn, {create: 1, exclusive: false}, function(_fileEntry) {\r\n\t\t\t\t\t\t\tfileEntry=_fileEntry;\r\n\t\t\t\t\t\tbatch(0);\r\n\t\t\t\t });\r\n\t\t\t},this);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nvar readFile=function(filename,cb,context) {\r\n\tAPI.fs.root.getFile(filename, {create: false, exclusive: false},function(fileEntry) {\r\n\t\tfileEntry.file(function(file){\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\treader.onloadend = function(e) {\r\n\t\t\t\tif (cb) cb.call(cb,this.result);\r\n\t\t\t};\r\n\t\t\treader.readAsText(file,\"utf8\");\r\n\t\t});\r\n\t}, console.error);\r\n}\r\n\r\nfunction createDir(rootDirEntry, folders,  cb) {\r\n  // Throw out './' or '/' and move on to prevent something like '/foo/.//bar'.\r\n  if (folders[0] == '.' || folders[0] == '') {\r\n    folders = folders.slice(1);\r\n  }\r\n  rootDirEntry.getDirectory(folders[0], {create: true}, function(dirEntry) {\r\n    // Recursively add the new subfolder (if we still have another to create).\r\n    if (folders.length) {\r\n      createDir(dirEntry, folders.slice(1),cb);\r\n    } else {\r\n\t\t\tcb();\r\n\t\t}\r\n  }, cb);\r\n};\r\n\r\n\r\nvar writeFile=function(filename,buf,cb,context){\r\n\tvar write=function(fileEntry){\r\n\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\tfileWriter.write(buf);\r\n\t\t\tfileWriter.onwriteend = function(e) {\r\n\t\t\t\tif (cb) cb.apply(cb,[buf.byteLength]);\r\n\t\t\t};\r\n\t\t}, console.error);\r\n\t}\r\n\r\n\tvar getFile=function(filename){\r\n\t\tAPI.fs.root.getFile(filename, {exclusive:true}, function(fileEntry) {\r\n\t\t\twrite(fileEntry);\r\n\t\t}, function(){\r\n\t\t\t\tAPI.fs.root.getFile(filename, {create:true,exclusive:true}, function(fileEntry) {\r\n\t\t\t\t\twrite(fileEntry);\r\n\t\t\t\t});\r\n\r\n\t\t});\r\n\t}\r\n\tvar slash=filename.lastIndexOf(\"/\");\r\n\tif (slash>-1) {\r\n\t\tcreateDir(API.fs.root, filename.substr(0,slash).split(\"/\"),function(){\r\n\t\t\tgetFile(filename);\r\n\t\t});\r\n\t} else {\r\n\t\tgetFile(filename);\r\n\t}\r\n}\r\n\r\nvar readdir=function(cb,context) {\r\n\tvar dirReader = API.fs.root.createReader();\r\n\tvar out=[],that=this;\r\n\tdirReader.readEntries(function(entries) {\r\n\t\tif (entries.length) {\r\n\t\t\tfor (var i = 0, entry; entry = entries[i]; ++i) {\r\n\t\t\t\tif (entry.isFile) {\r\n\t\t\t\t\tout.push([entry.name,entry.toURL ? entry.toURL() : entry.toURI()]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tAPI.files=out;\r\n\t\tif (cb) cb.apply(context,[out]);\r\n\t}, function(){\r\n\t\tif (cb) cb.apply(context,[null]);\r\n\t});\r\n}\r\nvar getFileURL=function(filename) {\r\n\tif (!API.files ) return null;\r\n\tvar file= API.files.filter(function(f){return f[0]==filename});\r\n\tif (file.length) return file[0][1];\r\n}\r\nvar rm=function(filename,cb,context) {\r\n\tvar url=getFileURL(filename);\r\n\tif (url) rmURL(url,cb,context);\r\n\telse if (cb) cb.apply(context,[false]);\r\n}\r\n\r\nvar rmURL=function(filename,cb,context) {\r\n\twebkitResolveLocalFileSystemURL(filename, function(fileEntry) {\r\n\t\tfileEntry.remove(function() {\r\n\t\t\tif (cb) cb.apply(context,[true]);\r\n\t\t}, console.error);\r\n\t},  function(e){\r\n\t\tif (cb) cb.apply(context,[false]);//no such file\r\n\t});\r\n}\r\nfunction errorHandler(e) {\r\n\tconsole.error('Error: ' +e.name+ \" \"+e.message);\r\n}\r\nvar initfs=function(grantedBytes,cb,context) {\r\n\twebkitRequestFileSystem(PERSISTENT, grantedBytes,  function(fs) {\r\n\t\tAPI.fs=fs;\r\n\t\tAPI.quota=grantedBytes;\r\n\t\treaddir(function(){\r\n\t\t\tAPI.initialized=true;\r\n\t\t\tcb.apply(context,[grantedBytes,fs]);\r\n\t\t},context);\r\n\t}, errorHandler);\r\n}\r\nvar init=function(quota,cb,context) {\r\n\tnavigator.webkitPersistentStorage.requestQuota(quota,\r\n\t\t\tfunction(grantedBytes) {\r\n\t\t\t\tinitfs(grantedBytes,cb,context);\r\n\t\t}, errorHandler\r\n\t);\r\n}\r\nvar queryQuota=function(cb,context) {\r\n\tvar that=this;\r\n\tnavigator.webkitPersistentStorage.queryUsageAndQuota(\r\n\t function(usage,quota){\r\n\t\t\tinitfs(quota,function(){\r\n\t\t\t\tcb.apply(context,[usage,quota]);\r\n\t\t\t},context);\r\n\t});\r\n}\r\nvar API={\r\n\tinit:init\r\n\t,readdir:readdir\r\n\t,checkUpdate:checkUpdate\r\n\t,rm:rm\r\n\t,rmURL:rmURL\r\n\t,getFileURL:getFileURL\r\n\t,writeFile:writeFile\r\n\t,readFile:readFile\r\n\t,download:download\r\n\t,get_head:get_head\r\n\t,get_date:get_date\r\n\t,get_size:get_size\r\n\t,getDownloadSize:get_size\r\n\t,queryQuota:queryQuota\r\n}\r\nmodule.exports=API;\r\n",
    "var html5fs=require(\"./html5fs\");\r\nvar React=(window&&window.React)||require(\"react\");\r\nvar E=React.createElement;\r\n\r\nvar htmlfs = React.createClass({\r\n\tgetInitialState:function() { \r\n\t\treturn {ready:false, quota:0,usage:0,Initialized:false,autoclose:this.props.autoclose};\r\n\t},\r\n\tinitFilesystem:function() {\r\n\t\tvar quota=this.props.quota||1024*1024*128; // default 128MB\r\n\t\tquota=parseInt(quota);\r\n\t\thtml5fs.init(quota,function(q){\r\n\t\t\tthis.dialog=false;\r\n\t\t\t$(this.refs.dialog1.getDOMNode()).modal('hide');\r\n\t\t\tthis.setState({quota:q,autoclose:true});\r\n\t\t},this);\r\n\t},\r\n\twelcome:function() {\r\n\t\treturn (\r\n\t\tE(\"div\", {ref: \"dialog1\", className: \"modal fade\", id: \"myModal\", \"data-backdrop\": \"static\"}, \r\n\t\t    E(\"div\", {className: \"modal-dialog\"}, \r\n\t\t      E(\"div\", {className: \"modal-content\"}, \r\n\t\t        E(\"div\", {className: \"modal-header\"}, \r\n\t\t          E(\"h4\", {className: \"modal-title\"}, \"Welcome\")\r\n\t\t        ), \r\n\t\t        E(\"div\", {className: \"modal-body\"}, \r\n\t\t          \"Browser will ask for your confirmation.\"\r\n\t\t        ), \r\n\t\t        E(\"div\", {className: \"modal-footer\"}, \r\n\t\t          E(\"button\", {onClick: this.initFilesystem, type: \"button\", \r\n\t\t            className: \"btn btn-primary\"}, \"Initialize File System\")\r\n\t\t        )\r\n\t\t      )\r\n\t\t    )\r\n\t\t  )\r\n\t\t );\r\n\t},\r\n\trenderDefault:function(){\r\n\t\tvar used=Math.floor(this.state.usage/this.state.quota *100);\r\n\t\tvar more=function() {\r\n\t\t\tif (used>50) return E(\"button\", {type: \"button\", className: \"btn btn-primary\"}, \"Allocate More\");\r\n\t\t\telse null;\r\n\t\t}\r\n\t\treturn (\r\n\t\tE(\"div\", {ref: \"dialog1\", className: \"modal fade\", id: \"myModal\", \"data-backdrop\": \"static\"}, \r\n\t\t    E(\"div\", {className: \"modal-dialog\"}, \r\n\t\t      E(\"div\", {className: \"modal-content\"}, \r\n\t\t        E(\"div\", {className: \"modal-header\"}, \r\n\t\t          E(\"h4\", {className: \"modal-title\"}, \"Sandbox File System\")\r\n\t\t        ), \r\n\t\t        E(\"div\", {className: \"modal-body\"}, \r\n\t\t          E(\"div\", {className: \"progress\"}, \r\n\t\t            E(\"div\", {className: \"progress-bar\", role: \"progressbar\", style: {width: used+\"%\"}}, \r\n\t\t               used, \"%\"\r\n\t\t            )\r\n\t\t          ), \r\n\t\t          E(\"span\", null, this.state.quota, \" total , \", this.state.usage, \" in used\")\r\n\t\t        ), \r\n\t\t        E(\"div\", {className: \"modal-footer\"}, \r\n\t\t          E(\"button\", {onClick: this.dismiss, type: \"button\", className: \"btn btn-default\", \"data-dismiss\": \"modal\"}, \"Close\"), \r\n\t\t          more()\r\n\t\t        )\r\n\t\t      )\r\n\t\t    )\r\n\t\t  )\r\n\t\t  );\r\n\t},\r\n\tdismiss:function() {\r\n\t\tvar that=this;\r\n\t\tsetTimeout(function(){\r\n\t\t\tthat.props.onReady(that.state.quota,that.state.usage);\t\r\n\t\t},0);\r\n\t},\r\n\tqueryQuota:function() {\r\n\t\tif (ksanagap.platform==\"chrome\") {\r\n\t\t\thtml5fs.queryQuota(function(usage,quota){\r\n\t\t\t\tthis.setState({usage:usage,quota:quota,initialized:true});\r\n\t\t\t},this);\t\t\t\r\n\t\t} else {\r\n\t\t\tthis.setState({usage:333,quota:1000*1000*1024,initialized:true,autoclose:true});\r\n\t\t}\r\n\t},\r\n\trender:function() {\r\n\t\tvar that=this;\r\n\t\tif (!this.state.quota || this.state.quota<this.props.quota) {\r\n\t\t\tif (this.state.initialized) {\r\n\t\t\t\tthis.dialog=true;\r\n\t\t\t\treturn this.welcome();\t\r\n\t\t\t} else {\r\n\t\t\t\treturn E(\"span\", null, \"checking quota\");\r\n\t\t\t}\t\t\t\r\n\t\t} else {\r\n\t\t\tif (!this.state.autoclose) {\r\n\t\t\t\tthis.dialog=true;\r\n\t\t\t\treturn this.renderDefault(); \r\n\t\t\t}\r\n\t\t\tthis.dismiss();\r\n\t\t\tthis.dialog=false;\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\tcomponentDidMount:function() {\r\n\t\tif (!this.state.quota) {\r\n\t\t\tthis.queryQuota();\r\n\r\n\t\t};\r\n\t},\r\n\tcomponentDidUpdate:function() {\r\n\t\tif (this.dialog) $(this.refs.dialog1.getDOMNode()).modal('show');\r\n\t}\r\n});\r\n\r\nmodule.exports=htmlfs;",
    "var ksana={\"platform\":\"remote\"};\r\nif (typeof window!=\"undefined\") {\r\n\twindow.ksana=ksana;\r\n\tif (typeof ksanagap==\"undefined\") {\r\n\t\twindow.ksanagap=require(\"./ksanagap\"); //compatible layer with mobile\r\n\t}\r\n}\r\nif (typeof process !=\"undefined\") {\r\n\tif (process.versions && process.versions[\"node-webkit\"]) {\r\n  \t\tif (typeof nodeRequire!=\"undefined\") ksana.require=nodeRequire;\r\n  \t\tksana.platform=\"node-webkit\";\r\n  \t\twindow.ksanagap.platform=\"node-webkit\";\r\n\t\tvar ksanajs=require(\"fs\").readFileSync(\"ksana.js\",\"utf8\").trim();\r\n\t\tksana.js=JSON.parse(ksanajs.substring(14,ksanajs.length-1));\r\n\t\twindow.kfs=require(\"./kfs\");\r\n  \t}\r\n} else if (typeof chrome!=\"undefined\"){//} && chrome.fileSystem){\r\n//\twindow.ksanagap=require(\"./ksanagap\"); //compatible layer with mobile\r\n\twindow.ksanagap.platform=\"chrome\";\r\n\twindow.kfs=require(\"./kfs_html5\");\r\n\tif(window.location.origin.indexOf(\"//127.0.0.1\")>-1) {\r\n\t\trequire(\"./livereload\")();\r\n\t}\r\n\tksana.platform=\"chrome\";\r\n} else {\r\n\tif (typeof ksanagap!=\"undefined\" && typeof fs!=\"undefined\") {//mobile\r\n\t\tvar ksanajs=fs.readFileSync(\"ksana.js\",\"utf8\").trim(); //android extra \\n at the end\r\n\t\tksana.js=JSON.parse(ksanajs.substring(14,ksanajs.length-1));\r\n\t\tksana.platform=ksanagap.platform;\r\n\t\tif (typeof ksanagap.android !=\"undefined\") {\r\n\t\t\tksana.platform=\"android\";\r\n\t\t}\r\n\t}\r\n}\r\nvar timer=null;\r\nvar React=window.React||require(\"react\");\r\nvar boot=function(appId,opts,cb) {\r\n\r\n\tif (typeof opts==\"function\") {\r\n\t\tcb=opts;\r\n\t\topts={};\r\n\t}\r\n\tksanagap.bootopts=opts;\r\n\tif (typeof React!=\"undefined\") {\r\n\t\tReact.initializeTouchEvents(true);\r\n\t}\r\n\tksana.appId=appId;\r\n\tif (ksanagap.platform==\"chrome\") { //need to wait for jsonp ksana.js\r\n\t\ttimer=setInterval(function(){\r\n\t\t\tif (ksana.ready){\r\n\t\t\t\tclearInterval(timer);\r\n\t\t\t\tif ( (opts.chromeFileSystem) && ksana.js && ksana.js.files && ksana.js.files.length) {\r\n\t\t\t\t\trequire(\"./installkdb\")(ksana.js,cb);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcb();\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},300);\r\n\t} else {\r\n\t\tcb();\r\n\t}\r\n}\r\n\r\nmodule.exports={boot:boot\r\n\t,htmlfs:require(\"./htmlfs\")\r\n\t,html5fs:require(\"./html5fs\")\r\n\t,liveupdate:require(\"./liveupdate\")\r\n\t,fileinstaller:require(\"./fileinstaller\")\r\n\t,downloader:require(\"./downloader\")\r\n\t,installkdb:require(\"./installkdb\")\r\n};",
    "var React=(window&&window.React)||require(\"react\");\r\nvar Fileinstaller=require(\"./fileinstaller\");\r\n\r\nvar getRequire_kdb=function() {\r\n    var required=[];\r\n    ksana.js.files.map(function(f){\r\n      if (f.indexOf(\".kdb\")==f.length-4) {\r\n        var slash=f.lastIndexOf(\"/\");\r\n        if (slash>-1) {\r\n          var dbid=f.substring(slash+1,f.length-4);\r\n          required.push({url:f,dbid:dbid,filename:dbid+\".kdb\"});\r\n        } else {\r\n          var dbid=f.substring(0,f.length-4);\r\n          required.push({url:ksana.js.baseurl+f,dbid:dbid,filename:f});\r\n        }        \r\n      }\r\n    });\r\n    return required;\r\n}\r\nvar callback=null;\r\nvar onReady=function() {\r\n\tcallback();\r\n}\r\nvar openFileinstaller=function(keep) {\r\n\tvar require_kdb=getRequire_kdb().map(function(db){\r\n\t  return {\r\n\t    url:window.location.origin+window.location.pathname+db.dbid+\".kdb\",\r\n\t    dbdb:db.dbid,\r\n\t    filename:db.filename\r\n\t  }\r\n\t})\r\n\treturn React.createElement(Fileinstaller, {quota: \"512M\", autoclose: !keep, needed: require_kdb, \r\n\t                 onReady: onReady});\r\n}\r\nvar installkdb=function(ksanajs,cb,context) {\r\n\tReact.render(openFileinstaller(),document.getElementById(\"main\"));\r\n\tcallback=cb;\r\n}\r\nmodule.exports=installkdb;",
    "//Simulate feature in ksanagap\r\n/* \r\n  runs on node-webkit only\r\n*/\r\n\r\nvar readDir=function(path) { //simulate Ksanagap function\r\n\tvar fs=nodeRequire(\"fs\");\r\n\tpath=path||\"..\";\r\n\tvar dirs=[];\r\n\tif (path[0]==\".\") {\r\n\t\tif (path==\".\") dirs=fs.readdirSync(\".\");\r\n\t\telse {\r\n\t\t\tdirs=fs.readdirSync(\"..\");\r\n\t\t}\r\n\t} else {\r\n\t\tdirs=fs.readdirSync(path);\r\n\t}\r\n\r\n\treturn dirs.join(\"\\uffff\");\r\n}\r\nvar listApps=function() {\r\n\r\n\tvar fs=nodeRequire(\"fs\");\r\n\tvar ksanajsfile=function(d) {return \"../\"+d+\"/ksana.js\"};\r\n\tvar dirs=fs.readdirSync(\"..\").filter(function(d){\r\n\t\t\t\treturn fs.statSync(\"../\"+d).isDirectory() && d[0]!=\".\"\r\n\t\t\t\t   && fs.existsSync(ksanajsfile(d));\r\n\t});\r\n\t\r\n\tvar out=dirs.map(function(d){\r\n\r\n\t\tvar fn=ksanajsfile(d);\r\n\t\tif (!fs.existsSync(fn)) return;\r\n\t\tvar content=fs.readFileSync(fn,\"utf8\");\r\n  \t\tcontent=content.replace(\"})\",\"}\");\r\n  \t\tcontent=content.replace(\"jsonp_handler(\",\"\");\r\n  \t\ttry{\r\n  \t\t\tvar obj= JSON.parse(content);\r\n\t\t\tobj.dbid=d;\r\n\t\t\tobj.path=d;\r\n\t\t\treturn obj;\r\n  \t\t} catch(e) {\r\n  \t\t\tconsole.log(e);\r\n  \t\t\treturn null;\r\n  \t\t}\r\n\t});\r\n\r\n\tout=out.filter(function(o){return !!o});\r\n\treturn JSON.stringify(out);\r\n}\r\n\r\n\r\n\r\nvar kfs={readDir:readDir,listApps:listApps};\r\n\r\nmodule.exports=kfs;",
    "\r\nvar readDir=function(cb,context){\r\n\trequire(\"./html5fs\").readdir(cb,context);\r\n}\r\nvar listApps=function(){\r\n\treturn \"[]\";\r\n}\r\nmodule.exports={readDir:readDir,listApps:listApps};",
    "var appname=\"installer\";\r\nif (typeof ksana==\"undefined\") {\r\n\twindow.ksana={platform:\"chrome\"};\r\n\tif (typeof process!==\"undefined\" && \r\n\t\tprocess.versions && process.versions[\"node-webkit\"]) {\r\n\t\twindow.ksana.platform=\"node-webkit\";\r\n\t}\r\n}\r\nvar switchApp=function(path) {\r\n\tvar fs=require(\"fs\");\r\n\tpath=\"../\"+path;\r\n\tappname=path;\r\n\tdocument.location.href= path+\"/index.html\"; \r\n\tprocess.chdir(path);\r\n}\r\nvar downloader={};\r\nvar rootPath=\"\";\r\n\r\nvar deleteApp=function(app) {\r\n\tconsole.error(\"not allow on PC, do it in File Explorer/ Finder\");\r\n}\r\nvar username=function() {\r\n\treturn \"\";\r\n}\r\nvar useremail=function() {\r\n\treturn \"\"\r\n}\r\nvar runtime_version=function() {\r\n\treturn \"1.4\";\r\n}\r\n\r\n//copy from liveupdate\r\nvar jsonp=function(url,dbid,callback,context) {\r\n  var script=document.getElementById(\"jsonp2\");\r\n  if (script) {\r\n    script.parentNode.removeChild(script);\r\n  }\r\n  window.jsonp_handler=function(data) {\r\n    if (typeof data==\"object\") {\r\n      data.dbid=dbid;\r\n      callback.apply(context,[data]);    \r\n    }  \r\n  }\r\n  window.jsonp_error_handler=function() {\r\n    console.error(\"url unreachable\",url);\r\n    callback.apply(context,[null]);\r\n  }\r\n  script=document.createElement('script');\r\n  script.setAttribute('id', \"jsonp2\");\r\n  script.setAttribute('onerror', \"jsonp_error_handler()\");\r\n  url=url+'?'+(new Date().getTime());\r\n  script.setAttribute('src', url);\r\n  document.getElementsByTagName('head')[0].appendChild(script); \r\n}\r\n\r\n\r\nvar loadKsanajs=function(){\r\n\r\n\tif (typeof process!=\"undefined\" && !process.browser) {\r\n\t\tvar ksanajs=require(\"fs\").readFileSync(\"./ksana.js\",\"utf8\").trim();\r\n\t\tdownloader=require(\"./downloader\");\r\n\t\tksana.js=JSON.parse(ksanajs.substring(14,ksanajs.length-1));\r\n\t\trootPath=process.cwd();\r\n\t\trootPath=require(\"path\").resolve(rootPath,\"..\").replace(/\\\\/g,\"/\")+'/';\r\n\t\tksana.ready=true;\r\n\t} else{\r\n\t\tvar url=window.location.origin+window.location.pathname.replace(\"index.html\",\"\")+\"ksana.js\";\r\n\t\tjsonp(url,appname,function(data){\r\n\t\t\tksana.js=data;\r\n\t\t\tksana.ready=true;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nloadKsanajs();\r\n\r\nvar boot=function(appId,cb) {\r\n\tif (typeof appId==\"function\") {\r\n\t\tcb=appId;\r\n\t\tappId=\"unknownapp\";\r\n\t}\r\n\tif (!ksana.js && ksana.platform==\"node-webkit\") {\r\n\t\tloadKsanajs();\r\n\t}\r\n\tksana.appId=appId;\r\n\tvar timer=setInterval(function(){\r\n\t\t\tif (ksana.ready){\r\n\t\t\t\tclearInterval(timer);\r\n\t\t\t\tcb();\r\n\t\t\t}\r\n\t\t});\r\n}\r\n\r\n\r\nvar ksanagap={\r\n\tplatform:\"node-webkit\",\r\n\tstartDownload:downloader.startDownload,\r\n\tdownloadedByte:downloader.downloadedByte,\r\n\tdownloadingFile:downloader.downloadingFile,\r\n\tcancelDownload:downloader.cancelDownload,\r\n\tdoneDownload:downloader.doneDownload,\r\n\tswitchApp:switchApp,\r\n\trootPath:rootPath,\r\n\tdeleteApp: deleteApp,\r\n\tusername:username, //not support on PC\r\n\tuseremail:username,\r\n\truntime_version:runtime_version,\r\n\tboot:boot\r\n}\r\nmodule.exports=ksanagap;",
    "var started=false;\r\nvar timer=null;\r\nvar bundledate=null;\r\nvar get_date=require(\"./html5fs\").get_date;\r\nvar checkIfBundleUpdated=function() {\r\n\tget_date(\"bundle.js\",function(date){\r\n\t\tif (bundledate &&bundledate!=date){\r\n\t\t\tlocation.reload();\r\n\t\t}\r\n\t\tbundledate=date;\r\n\t});\r\n}\r\nvar livereload=function() {\r\n\tif(window.location.origin.indexOf(\"//127.0.0.1\")===-1) return;\r\n\r\n\tif (started) return;\r\n\r\n\ttimer1=setInterval(function(){\r\n\t\tcheckIfBundleUpdated();\r\n\t},2000);\r\n\tstarted=true;\r\n}\r\n\r\nmodule.exports=livereload;",
    "\r\nvar jsonp=function(url,dbid,callback,context) {\r\n  var script=document.getElementById(\"jsonp\");\r\n  if (script) {\r\n    script.parentNode.removeChild(script);\r\n  }\r\n  if (typeof dbid==\"function\") {\r\n    context=callback;\r\n    callback=dbid;\r\n    dbid=\"\";\r\n  }\r\n  window.jsonp_handler=function(data) {\r\n    //console.log(\"receive from ksana.js\",data);\r\n    if (typeof data==\"object\" && dbid) {\r\n      if (typeof data.dbid==\"undefined\") {\r\n        data.dbid=dbid;\r\n      }\r\n    }\r\n    callback.apply(context,[data]);\r\n  }\r\n\r\n  window.jsonp_error_handler=function() {\r\n    console.error(\"url unreachable\",url);\r\n    callback.apply(context,[null]);\r\n  }\r\n\r\n  script=document.createElement('script');\r\n  script.setAttribute('id', \"jsonp\");\r\n  script.setAttribute('onerror', \"jsonp_error_handler()\");\r\n  url=url+'?'+(new Date().getTime());\r\n  script.setAttribute('src', url);\r\n  document.getElementsByTagName('head')[0].appendChild(script); \r\n}\r\nvar runtime_version_ok=function(minruntime) {\r\n  if (!minruntime) return true;//not mentioned.\r\n  var min=parseFloat(minruntime);\r\n  var runtime=parseFloat( ksanagap.runtime_version()||\"1.0\");\r\n  if (min>runtime) return false;\r\n  return true;\r\n}\r\n\r\nvar needToUpdate=function(fromjson,tojson) {\r\n  var needUpdates=[];\r\n  for (var i=0;i<fromjson.length;i++) { \r\n    var to=tojson[i];\r\n    var from=fromjson[i];\r\n    var newfiles=[],newfilesizes=[],removed=[];\r\n    \r\n    if (!to || !to.files) continue; //cannot reach host\r\n    if (!runtime_version_ok(to.minruntime)) {\r\n      console.warn(\"runtime too old, need \"+to.minruntime);\r\n      continue; \r\n    }\r\n    if (!from.filedates) {\r\n      console.warn(\"missing filedates in ksana.js of \"+from.dbid);\r\n      continue;\r\n    }\r\n    from.filedates.map(function(f,idx){\r\n      var newidx=to.files.indexOf( from.files[idx]);\r\n      if (newidx==-1) {\r\n        //file removed in new version\r\n        removed.push(from.files[idx]);\r\n      } else {\r\n        var fromdate=Date.parse(f);\r\n        var todate=Date.parse(to.filedates[newidx]);\r\n        if (fromdate<todate) {\r\n          newfiles.push( to.files[newidx] );\r\n          newfilesizes.push(to.filesizes[newidx]);\r\n        }        \r\n      }\r\n    });\r\n    if (newfiles.length) {\r\n      from.newfiles=newfiles;\r\n      from.newfilesizes=newfilesizes;\r\n      from.removed=removed;\r\n      needUpdates.push(from);\r\n    }\r\n  }\r\n  return needUpdates;\r\n}\r\nvar getUpdatables=function(apps,cb,context) {\r\n  getRemoteJson(apps,function(jsons){\r\n    var hasUpdates=needToUpdate(apps,jsons);\r\n    cb.apply(context,[hasUpdates]);\r\n  },context);\r\n}\r\nvar getRemoteJson=function(apps,cb,context) {\r\n  var taskqueue=[],output=[];\r\n  var makecb=function(app){\r\n    return function(data){\r\n        if (!(data && typeof data =='object' && data.__empty)) output.push(data);\r\n        if (!app.baseurl) {\r\n          taskqueue.shift({__empty:true});\r\n        } else {\r\n          var url=app.baseurl+\"/ksana.js\";\r\n          try {\r\n            jsonp( url ,app.dbid,taskqueue.shift(), context);             \r\n          } catch(e) {\r\n            console.log(e);\r\n            taskqueue.shift({__empty:true});\r\n          }\r\n        }\r\n    };\r\n  };\r\n  apps.forEach(function(app){taskqueue.push(makecb(app))});\r\n\r\n  taskqueue.push(function(data){\r\n    output.push(data);\r\n    cb.apply(context,[output]);\r\n  });\r\n\r\n  taskqueue.shift()({__empty:true}); //run the task\r\n}\r\nvar humanFileSize=function(bytes, si) {\r\n    var thresh = si ? 1000 : 1024;\r\n    if(bytes < thresh) return bytes + ' B';\r\n    var units = si ? ['kB','MB','GB','TB','PB','EB','ZB','YB'] : ['KiB','MiB','GiB','TiB','PiB','EiB','ZiB','YiB'];\r\n    var u = -1;\r\n    do {\r\n        bytes /= thresh;\r\n        ++u;\r\n    } while(bytes >= thresh);\r\n    return bytes.toFixed(1)+' '+units[u];\r\n};\r\nvar humanDate=function(datestring) {\r\n    var d=Date.parse(datestring);\r\n    if (isNaN(d)) {\r\n      return \"invalid date\";\r\n    } else {\r\n      return new Date(d).toLocaleString();\r\n    }\r\n}\r\nvar start=function(ksanajs,cb,context){\r\n  var files=ksanajs.newfiles||ksanajs.files;\r\n  var baseurl=ksanajs.baseurl|| \"http://127.0.0.1:8080/\"+ksanajs.dbid+\"/\";\r\n  var started=ksanagap.startDownload(ksanajs.dbid,baseurl,files.join(\"\\uffff\"));\r\n  cb.apply(context,[started]);\r\n}\r\nvar status=function(){\r\n  var nfile=ksanagap.downloadingFile();\r\n  var downloadedByte=ksanagap.downloadedByte();\r\n  var done=ksanagap.doneDownload();\r\n  return {nfile:nfile,downloadedByte:downloadedByte, done:done};\r\n}\r\n\r\nvar cancel=function(){\r\n  return ksanagap.cancelDownload();\r\n}\r\n\r\nvar liveupdate={ humanFileSize: humanFileSize, humanDate:humanDate,\r\n  needToUpdate: needToUpdate , jsonp:jsonp, \r\n  getUpdatables:getUpdatables,\r\n  start:start,\r\n  cancel:cancel,\r\n  status:status\r\n  };\r\nmodule.exports=liveupdate;",
    "function mkdirP (p, mode, f, made) {\r\n     var path = nodeRequire('path');\r\n     var fs = nodeRequire('fs');\r\n\t\r\n    if (typeof mode === 'function' || mode === undefined) {\r\n        f = mode;\r\n        mode = 0x1FF & (~process.umask());\r\n    }\r\n    if (!made) made = null;\r\n\r\n    var cb = f || function () {};\r\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\r\n    p = path.resolve(p);\r\n\r\n    fs.mkdir(p, mode, function (er) {\r\n        if (!er) {\r\n            made = made || p;\r\n            return cb(null, made);\r\n        }\r\n        switch (er.code) {\r\n            case 'ENOENT':\r\n                mkdirP(path.dirname(p), mode, function (er, made) {\r\n                    if (er) cb(er, made);\r\n                    else mkdirP(p, mode, cb, made);\r\n                });\r\n                break;\r\n\r\n            // In the case of any other error, just see if there's a dir\r\n            // there already.  If so, then hooray!  If not, then something\r\n            // is borked.\r\n            default:\r\n                fs.stat(p, function (er2, stat) {\r\n                    // if the stat fails, then that's super weird.\r\n                    // let the original error be the failure reason.\r\n                    if (er2 || !stat.isDirectory()) cb(er, made)\r\n                    else cb(null, made);\r\n                });\r\n                break;\r\n        }\r\n    });\r\n}\r\n\r\nmkdirP.sync = function sync (p, mode, made) {\r\n    var path = nodeRequire('path');\r\n    var fs = nodeRequire('fs');\r\n    if (mode === undefined) {\r\n        mode = 0x1FF & (~process.umask());\r\n    }\r\n    if (!made) made = null;\r\n\r\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\r\n    p = path.resolve(p);\r\n\r\n    try {\r\n        fs.mkdirSync(p, mode);\r\n        made = made || p;\r\n    }\r\n    catch (err0) {\r\n        switch (err0.code) {\r\n            case 'ENOENT' :\r\n                made = sync(path.dirname(p), mode, made);\r\n                sync(p, mode, made);\r\n                break;\r\n\r\n            // In the case of any other error, just see if there's a dir\r\n            // there already.  If so, then hooray!  If not, then something\r\n            // is borked.\r\n            default:\r\n                var stat;\r\n                try {\r\n                    stat = fs.statSync(p);\r\n                }\r\n                catch (err1) {\r\n                    throw err0;\r\n                }\r\n                if (!stat.isDirectory()) throw err0;\r\n                break;\r\n        }\r\n    }\r\n\r\n    return made;\r\n};\r\n\r\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\r\n"
  ]
}